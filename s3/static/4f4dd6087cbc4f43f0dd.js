"use strict";(self.webpackChunkcloud_onchain_trade_sdk=self.webpackChunkcloud_onchain_trade_sdk||[]).push([[6684],{38097:(e,i,t)=>{t.d(i,{d0:()=>g,SD:()=>P,ch:()=>b,uT:()=>_,PH:()=>L,v_:()=>O,iA:()=>T,a1:()=>w,Ub:()=>h,Gc:()=>D,Jo:()=>R,M2:()=>C,CE:()=>$,ls:()=>x,yi:()=>l,uY:()=>u});var s=t(52983),n=t(95313),o=t(53958),r=t(17921),a=t(25048);const d=(0,t(91890).Ue)((e=>({initialed:!1,orders:[],orderMap:{},initialOrders(i){e((0,a.ZP)((e=>{e.initialed=!0,e.orders=i.map((e=>e.hash)),e.orderMap=i.reduce(((e,i)=>Object.assign(Object.assign({},e),{[i.hash]:i})),{})})))},addAOrder(i){e((0,a.ZP)((e=>{e.orders.push(i.hash),e.orderMap[i.hash]=i})))},deleteAOrderByHash(i){e((0,a.ZP)((e=>{delete e.orderMap[i],e.orders=e.orders.filter((e=>e!==i))})))}}))),l=()=>d((e=>e.orders)),u=()=>d((e=>e.initialed)),c=(e,i)=>d((t=>{var s,n;return null===(n=null===(s=t.orderMap)||void 0===s?void 0:s[e])||void 0===n?void 0:n[i]})),m=e=>{const i=c(e,"amountIn"),t=c(e,"tokenIn"),a=(0,n.QG)(t),d=(0,n.At)(t),l=(0,n.RK)(d),u=d&&void 0!==a;return(0,s.useMemo)((()=>({initialed:u,symbol:d,decimals:a,address:t,tokenIn:t,amountIn:new r.Z((0,o.mb)(i,a)),qtyPrecision:l})),[u,d,a,t,i,l])},p=e=>{const{symbol:i}=m(e),t=(0,n.Ms)(i);return(0,s.useMemo)((()=>t),[t])};var y=t(87718);const g=()=>{const{symbol:e}=(0,y.Dp)(),i=(0,n.d0)();return(0,s.useCallback)((t=>{var s;t!==e&&(i({isBlank:!1,stateSymbol:t}),null===(s=document.querySelector("#orderForm"))||void 0===s||s.scrollIntoView({behavior:"smooth"}))}),[i,e])};var f=t(73337);const P=e=>{const i=(e=>{const{amountIn:i}=m(e);return(0,s.useMemo)((()=>new r.Z(i)),[i])})(e),{initialed:t,symbol:n,qtyPrecision:o}=m(e);return(0,s.useMemo)((()=>t&&i.isFinite()?`${(0,f.uf)(i,o)} ${n}`:"-"),[i,t,n,o])};var v=t(37207);const B=e=>{const i=c(e,"qty"),t=c(e,"limitPrice"),{initialed:a,amountIn:d}=m(e),l=(e=>{const i=c(e,"qty"),t=c(e,"pairBase"),a=c(e,"limitPrice"),{data:d}=(0,n.Bu)(t,{watch:!0});return(0,s.useMemo)((()=>d&&d.feeConfig&&d.feeConfig.openFeeP?new r.Z(i).multipliedBy(a).multipliedBy((0,o.mb)(d.feeConfig.openFeeP,v.cB.percent)):"-"),[d,a,i])})(e),{data:u}=(0,n.VT)(),{symbol:y,index:g}=p(e),f=y&&a;return(0,s.useMemo)((()=>f?new r.Z(i).multipliedBy(t).dividedBy(new r.Z(d).multipliedBy(g).minus(l).minus((0,o.mb)(null==u?void 0:u.executionFeeUsd.toString(),v.cB.usd))):new r.Z(1/0)),[f,i,t,d,g,l,null==u?void 0:u.executionFeeUsd])},b=e=>{const i=B(e);return(0,s.useMemo)((()=>i.isFinite()?`${i.toFixed(1)}x`:"-"),[i])},_=e=>{const i=c(e,"limitPrice"),t=c(e,"pair"),o=(0,n.fV)(t);return(0,s.useMemo)((()=>{const e=new r.Z(i);return e.isFinite()?(0,f.uf)(e,o):"-"}),[i,o])},L=e=>{const i=c(e,"pair"),t=(0,n.fV)(i),{close:o}=(0,n.Le)(i);return(0,s.useMemo)((()=>{const e=new r.Z(o);return e.isFinite()?(0,f.uf)(e,t):"-"}),[o,t])},O=e=>{const i=c(e,"qty"),t=c(e,"limitPrice");return(0,s.useMemo)((()=>{const e=new r.Z(i).multipliedBy(t);return e.isFinite()?e.toFixed(1):"-"}),[t,i])},T=e=>{const i=c(e,"pair"),t=c(e,"isLong"),{productMap:n}=(0,y.GS)();return(0,s.useMemo)((()=>{var e,s;return{symbol:i,isLong:t,symbolType:null===(e=n[i])||void 0===e?void 0:e.symbolType,symbolName:null===(s=n[i])||void 0===s?void 0:s.symbolName}}),[t,i,n])},w=e=>{const i=c(e,"takeProfit"),t=c(e,"stopLoss"),o=c(e,"pair"),a=(0,n.fV)(o);return(0,s.useMemo)((()=>{const e=new r.Z(i),s=new r.Z(t);return{takeProfit:e.isFinite()?(0,f.uf)(e,a):"-",stopLoss:s.isFinite()&&!s.isEqualTo(0)?(0,f.uf)(s,a):"-"}}),[a,t,i])},h=e=>{const i=c(e,"limitPrice"),t=c(e,"side"),a=c(e,"pair"),d=(0,n.fV)(a),l=(e=>{const i=c(e,"pair"),t=c(e,"pairBase"),a=c(e,"isLong"),d=c(e,"qty"),{close:l}=(0,n.Le)(i),{data:u}=(0,n.Bu)(t),{data:m}=(0,n.Jg)(t);return(0,s.useMemo)((()=>{if(u&&m){const{slippageType:e,onePercentDepthAboveUsd:i,onePercentDepthBelowUsd:t,slippageLongP:s,slippageShortP:n}=u.slippageConfig||{},{longQty:c,shortQty:p}=m;if(1===e)return a?new r.Z(d).multipliedBy(l).plus(new r.Z((0,o.mb)(c.toString(),v.cB.qty)).multipliedBy(l)).dividedBy((0,o.mb)(i.toString(),v.cB.usd)).toFixed(4,r.Z.ROUND_UP):new r.Z(d).multipliedBy(l).plus(new r.Z((0,o.mb)(p.toString(),v.cB.qty)).multipliedBy(l)).dividedBy((0,o.mb)(t.toString(),v.cB.usd)).toFixed(4,r.Z.ROUND_UP);if(0===e)return a?(0,o.mb)(s.toString(),v.cB.percent):(0,o.mb)(n.toString(),v.cB.percent);if(2===e){const e=new r.Z(d).multipliedBy(l),u=new r.Z((0,o.mb)(c.toString(),v.cB.qty)).multipliedBy(l),m=new r.Z((0,o.mb)(p.toString(),v.cB.qty)).multipliedBy(l),y=(0,o.mb)((a?i:t).toString(),v.cB.usd),g=new r.Z((0,o.mb)((a?s:n).toString(),v.cB.percent)),f=(a?e.minus(m).plus(u):e.minus(u).plus(m)).dividedBy(y);return r.Z.max(f,g).toFixed(4,r.Z.ROUND_UP)}return NaN}return NaN}),[a,l,m,u,d])})(e),u=(0,s.useMemo)((()=>"LONG"===t),[t]);return(0,s.useMemo)((()=>{const e=u?new r.Z(i).multipliedBy(new r.Z(1).minus(l)):new r.Z(i).multipliedBy(new r.Z(1).plus(l));return e.isFinite()?(0,f.uf)(e,d):"-"}),[u,i,d,l])};var k=t(76398),S=t(4137),M=t(52099),Z=t(90322),F=t(45779),N=t(90974);const D=()=>{const{getI18n:e}=(0,N.V6)(),{setDisabled:i}=(0,y.a9)(),{submit:t}=(0,S.t)({getI18n:e}),o=(0,n.E4)(),r="cancelLimitOrder",{writeAsync:a}=(0,M.GG)(Object.assign(Object.assign({},o),{mode:"recklesslyUnprepared",functionName:r}));return(0,s.useCallback)((e=>(0,k.__awaiter)(void 0,void 0,void 0,(function*(){i(!0);try{const i=[e],s=yield(0,Z.$q)(Object.assign(Object.assign({},o),{functionName:r,args:i})),{gasLimit:n}=s.request;yield t((()=>null==a?void 0:a({recklesslySetUnpreparedArgs:i,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(n)}}))),F.ee.emit("REFETCH_ORDER_LIST",void 0)}catch(e){}return i(!1),!0}))),[o,t,a,i])},I=new(t(42405).v);var E=t(59712);const R=()=>{const{getI18n:e}=(0,N.V6)(),{setDisabled:i}=(0,y.a9)(),t=(0,n.E4)(),{submit:a}=(0,S.t)({getI18n:e}),{writeAsync:d}=(0,M.GG)(Object.assign(Object.assign({},t),{mode:"recklesslyUnprepared",functionName:"updateOrderTpAndSl"})),{writeAsync:l}=(0,M.GG)(Object.assign(Object.assign({},t),{mode:"recklesslyUnprepared",functionName:"updateOrderTp"})),{writeAsync:u}=(0,M.GG)(Object.assign(Object.assign({},t),{mode:"recklesslyUnprepared",functionName:"updateOrderSl"}));(0,s.useEffect)((()=>I.on("UPDATE_ORDER_TP_SL",(e=>(0,k.__awaiter)(void 0,void 0,void 0,(function*(){const{hash:s,takeProfit:n,stopLoss:l,closeModalCallBack:u}=e;i(!0),E.debug("updateOrderTpAndSl",s,n,l);try{const e=[s,(0,o.r0)(n,v.cB.price),new r.Z(l).isEqualTo(0)||new r.Z(l).isNaN()?0:(0,o.r0)(l,v.cB.price)],i=yield(0,Z.$q)(Object.assign(Object.assign({},t),{functionName:"updateOrderTpAndSl",args:e})),{gasLimit:c}=i.request;yield a((()=>null==d?void 0:d({recklesslySetUnpreparedArgs:e,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(c)}})),{onUserConfirm(){null==u||u()}}),F.ee.emit("REFETCH_ORDER_LIST",void 0)}catch(e){}i(!1)}))))),[t,a,d,i]),(0,s.useEffect)((()=>I.on("UPDATE_ORDER_TP",(e=>(0,k.__awaiter)(void 0,void 0,void 0,(function*(){const{hash:s,takeProfit:n,closeModalCallBack:r}=e;i(!0),E.debug("updateOrderTp",s,n);try{const e=[s,(0,o.r0)(n,v.cB.price)],i=yield(0,Z.$q)(Object.assign(Object.assign({},t),{functionName:"updateOrderTp",args:e})),{gasLimit:d}=i.request;yield a((()=>null==l?void 0:l({recklesslySetUnpreparedArgs:e,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(d)}})),{onUserConfirm(){null==r||r()}}),F.ee.emit("REFETCH_ORDER_LIST",void 0)}catch(e){}i(!1)}))))),[t,a,l,i]),(0,s.useEffect)((()=>I.on("UPDATE_ORDER_SL",(e=>(0,k.__awaiter)(void 0,void 0,void 0,(function*(){const{hash:s,stopLoss:n,closeModalCallBack:d}=e;i(!0),E.debug("updateOrderSl",s,n);try{const e=[s,new r.Z(n).isEqualTo(0)||new r.Z(n).isNaN()?0:(0,o.r0)(n,v.cB.price)],i=yield(0,Z.$q)(Object.assign(Object.assign({},t),{functionName:"updateOrderSl",args:e})),{gasLimit:l}=i.request;yield a((()=>null==u?void 0:u({recklesslySetUnpreparedArgs:e,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(l)}})),{onUserConfirm(){null==d||d()}}),F.ee.emit("REFETCH_ORDER_LIST",void 0)}catch(e){}i(!1)}))))),[t,a,u,i])},q=()=>(0,s.useMemo)((()=>({updateTpAndSl:({hash:e,takeProfit:i,stopLoss:t},s)=>(0,k.__awaiter)(void 0,void 0,void 0,(function*(){I.emit("UPDATE_ORDER_TP_SL",{hash:e,takeProfit:i,stopLoss:t,closeModalCallBack:s})})),updateTp:({hash:e,takeProfit:i},t)=>(0,k.__awaiter)(void 0,void 0,void 0,(function*(){I.emit("UPDATE_ORDER_TP",{hash:e,takeProfit:i,closeModalCallBack:t})})),updateSl:({hash:e,stopLoss:i},t)=>(0,k.__awaiter)(void 0,void 0,void 0,(function*(){I.emit("UPDATE_ORDER_SL",{hash:e,stopLoss:i,closeModalCallBack:t})}))})),[]);var A=t(91449);const U=e=>e.map((e=>{const i={orderHash:e.orderHash,broker:e.broker,pair:e.pair.replace("/",""),pairBase:e.pairBase,isLong:e.isLong,tokenIn:e.tokenIn,amountIn:e.amountIn.toString(),qty:(0,o.mb)(e.qty.toString(),v.cB.qty),limitPrice:(0,o.mb)(e.limitPrice.toString(),v.cB.price),stopLoss:(0,o.mb)(e.stopLoss.toString(),v.cB.price),takeProfit:(0,o.mb)(e.takeProfit.toString(),v.cB.price),timestamp:`${e.timestamp}000`,hash:e.orderHash,side:e.isLong?"LONG":"SHORT"};return Object.assign(Object.assign({},e),i)})).sort(((e,i)=>Number(i.timestamp)-Number(e.timestamp))),C=()=>{const e=(0,n.E4)(),{address:i,isConnected:t}=(0,M.mA)(),o=d((e=>e.initialOrders)),r=u(),{data:a=[],refetch:l,isSuccess:c,isFetching:m}=(0,M.do)(Object.assign(Object.assign({},e),{functionName:"getLimitOrders",args:[i,"0x0000000000000000000000000000000000000000"],enabled:t,cacheOnBlock:!0,cacheTime:A.g_}));(0,s.useEffect)((()=>{t||o([])}),[o,t]),(0,s.useEffect)((()=>{c&&!r&&o(U(a))}),[a,o,c,r]),(0,s.useEffect)((()=>{r&&!m&&o(U(a))}),[a,o,m,r]),(0,s.useEffect)((()=>F.ee.on("REFETCH_ORDER_LIST",(()=>{l()}))),[l])},$=e=>{const{close:i}=(0,n.Le)(e);return(0,s.useMemo)((()=>i),[i])};var j=t(59629);const x=e=>{const i=c(e,"qty"),t=c(e,"limitPrice"),a=c(e,"side"),d=c(e,"pair"),l=c(e,"takeProfit"),u=c(e,"stopLoss"),y=(0,n.fV)(d),g=B(e),{data:P}=(0,n.VT)(),{index:b}=p(e),{qtyPrecision:_,symbol:L}=m(e),O=(0,s.useMemo)((()=>"LONG"===a),[a]),T=(0,s.useMemo)((()=>_),[_]),w=(0,s.useMemo)((()=>2),[]),h=(0,s.useMemo)((()=>O?(null==P?void 0:P.maxTakeProfitP)?(0,o.mb)(P.maxTakeProfitP,v.cB.percent):"Infinity":(null==P?void 0:P.maxTakeProfitP)?r.Z.minimum(new r.Z(g),(0,o.mb)(P.maxTakeProfitP,v.cB.percent)).toString():"Infinity"),[O,g,null==P?void 0:P.maxTakeProfitP]),k=(e=>{const i=c(e,"qty"),t=c(e,"pairBase"),a=c(e,"limitPrice"),d=(0,s.useMemo)((()=>new r.Z(i).multipliedBy(a)),[a,i]),l=(0,n.tz)(t,d);return(0,s.useMemo)((()=>(0,o.mb)(null==l?void 0:l.liqLostP,v.cB.percent)),[l])})(e),S=(0,j.D)((e=>O?new r.Z(e).multipliedBy(b).dividedBy(i).plus(t):new r.Z(t).minus(new r.Z(e).multipliedBy(b).dividedBy(i)))),M=(0,j.D)((e=>O?new r.Z(e).minus(t).multipliedBy(i).dividedBy(b):new r.Z(t).minus(e).multipliedBy(i).dividedBy(b))),Z=(0,j.D)((e=>new r.Z(i).multipliedBy(t).multipliedBy(e).dividedBy(g).dividedBy(b))),F=(0,j.D)((e=>new r.Z(e).multipliedBy(b).multipliedBy(g).dividedBy(new r.Z(i).multipliedBy(t)))),N=(0,j.D)((e=>O?new r.Z(e).multipliedBy(b).dividedBy(i).plus(t):new r.Z(t).minus(new r.Z(e).multipliedBy(b).dividedBy(i)))),D=(0,j.D)((e=>O?new r.Z(e).minus(t).multipliedBy(i).dividedBy(b):new r.Z(t).minus(e).multipliedBy(i).dividedBy(b))),I=(0,j.D)((e=>new r.Z(i).multipliedBy(t).multipliedBy(e).dividedBy(g).dividedBy(b))),E=(0,j.D)((e=>new r.Z(e).multipliedBy(b).multipliedBy(g).dividedBy(new r.Z(i).multipliedBy(t)))),R=(0,j.D)((e=>`${(0,f.uf)(e,T)} ${L}`)),A=(0,j.D)((e=>(0,f.uf)(e,w))),U=(0,j.D)((e=>(0,f.uf)(e,y)));return(0,s.useMemo)((()=>({getTakeProfitPrice:S,getTakeProfitPNL:M,getTakeProfitPNLByROI:Z,getTakeProfitROI:F,getStopLossPrice:N,getStopLossPNL:D,getStopLossPNLByROI:I,getStopLossROI:E,pair:d,takeProfit:l,stopLoss:u,pricePrecision:y,PNLPrecision:T,ROIPrecision:w,side:a,maxTakeProfitROI:h,minStopLossROI:(-k).toString(),entryPrice:t,formatPNL:R,formatROI:A,formatPrice:U,useContractUpdateTPSL:q})),[S,M,Z,F,N,D,I,E,d,l,u,y,T,w,a,h,k,t,R,A,U])}},42093:(e,i,t)=>{t.d(i,{d0:()=>g,SD:()=>P,A4:()=>v,ch:()=>_,lW:()=>h,PH:()=>k,RM:()=>M,v_:()=>Z,iA:()=>F,a1:()=>N,eO:()=>$,Im:()=>H,Jo:()=>z,OB:()=>W,CE:()=>X,zS:()=>ie,KB:()=>ye,mO:()=>fe,$J:()=>l,Zm:()=>u});var s=t(52983),n=t(95313),o=t(53958),r=t(17921),a=t(25048);const d=(0,t(91890).Ue)((e=>({initialed:!1,positions:[],positionMap:{},initialPositions(i){e((0,a.ZP)((e=>{e.initialed=!0,e.positions=i.map((e=>e.hash)),e.positionMap=i.reduce(((e,i)=>Object.assign(Object.assign({},e),{[i.hash]:i})),{})})))},addAPosition(i){e((0,a.ZP)((e=>{e.positions.push(i.hash),e.positionMap[i.hash]=i})))},deleteAPositionByHash(i){e((0,a.ZP)((e=>{delete e.positionMap[i],e.positions=e.positions.filter((e=>e!==i))})))},updateAPosition(i,t,s){e((0,a.ZP)((e=>{if(e.positionMap[i]){const n=e.positionMap[i];e.positionMap[i]=Object.assign(Object.assign({},n),{[t]:s})}})))}}))),l=()=>d((e=>e.positions)),u=()=>d((e=>e.initialed)),c=(e,i)=>d((t=>{var s,n;return null===(n=null===(s=t.positionMap)||void 0===s?void 0:s[e])||void 0===n?void 0:n[i]})),m=e=>{const i=c(e,"margin"),t=c(e,"marginToken"),a=(0,n.QG)(t),d=(0,n.At)(t),l=(0,n.RK)(d),u=d&&void 0!==i&&void 0!==a;return(0,s.useMemo)((()=>({initialed:u,symbol:d,decimals:a,margin:new r.Z((0,o.mb)(i,a)),address:t,marginToken:t,qtyPrecision:l})),[u,d,a,i,t,l])},p=e=>{const{symbol:i}=m(e),t=(0,n.Ms)(i);return(0,s.useMemo)((()=>t),[t])};var y=t(87718);const g=()=>{const{symbol:e}=(0,y.Dp)(),i=(0,n.d0)();return(0,s.useCallback)((t=>{var s;t!==e&&(i({isBlank:!1,stateSymbol:t}),null===(s=document.querySelector("#orderForm"))||void 0===s||s.scrollIntoView({behavior:"smooth"}))}),[i,e])};var f=t(73337);const P=e=>{const{initialed:i,margin:t,symbol:n,qtyPrecision:o}=m(e);return(0,s.useMemo)((()=>i&&t.isFinite()?`${(0,f.uf)(t,o)} ${n}`:"-"),[i,t,o,n])},v=e=>{const i=c(e,"pair"),t=c(e,"entryPrice"),o=(0,n.fV)(i);return(0,s.useMemo)((()=>new r.Z(t).isFinite()?(0,f.uf)(t,o):"-"),[t,o])},B=e=>{const{symbol:i,index:t}=p(e),n=m(e);return(0,s.useMemo)((()=>Object.assign(Object.assign({},n),{initialed:n.initialed&&void 0!==i,margin:new r.Z(n.margin).multipliedBy(t)})),[t,n,i])},b=e=>{const i=c(e,"qty"),t=c(e,"entryPrice"),{margin:n,initialed:o}=B(e);return(0,s.useMemo)((()=>o?new r.Z(i).multipliedBy(t).dividedBy(n):new r.Z(1/0)),[t,o,n,i])},_=e=>{const i=b(e);return(0,s.useMemo)((()=>i.isFinite()?`${i.toFixed(1)}x`:"-"),[i])},L=e=>{const i=c(e,"openFee"),t=c(e,"executionFee"),n=c(e,"fundingFee"),r=c(e,"holdingFee"),{decimals:a}=m(e);return(0,s.useMemo)((()=>({openFee:(0,o.mb)(i,a),fundingFee:(0,o.mb)(n,a),executionFee:(0,o.mb)(t,a),holdingFee:(0,o.mb)(r,a)})),[a,t,n,r,i])},O=e=>{const{openFee:i,executionFee:t,fundingFee:n,holdingFee:o}=L(e),{symbol:a,index:d}=p(e);return(0,s.useMemo)((()=>({initialed:void 0!==a,openFee:new r.Z(i).multipliedBy(d),fundingFee:new r.Z(n).multipliedBy(d),executionFee:new r.Z(t).multipliedBy(d),holdingFee:new r.Z(o).multipliedBy(d)})),[t,n,o,d,i,a])};var T=t(37207);const w=e=>{const i=c(e,"qty"),t=c(e,"pairBase"),a=c(e,"entryPrice"),d=(0,s.useMemo)((()=>new r.Z(i).multipliedBy(a)),[a,i]),l=(0,n.tz)(t,d);return(0,s.useMemo)((()=>(0,o.mb)(null==l?void 0:l.liqLostP,T.cB.percent)),[l])},h=e=>{const i=c(e,"entryPrice"),t=c(e,"side"),o=c(e,"pair"),a=c(e,"qty"),d=(0,n.fV)(o),{initialed:l,fundingFee:u,holdingFee:m}=O(e),{initialed:p,margin:y}=B(e),g=w(e),P=l&&p,v=(0,s.useMemo)((()=>"LONG"===t),[t]),b=(0,s.useMemo)((()=>new r.Z(y).multipliedBy(g).plus(new r.Z(u).minus(m)).dividedBy(a)),[u,m,g,y,a]);return(0,s.useMemo)((()=>{const e=v?new r.Z(i).minus(b):new r.Z(i).plus(b);return P&&e.isFinite()?e.isNegative()?"-":(0,f.uf)(e,d):"-"}),[i,P,v,b,d])},k=e=>{const i=c(e,"pair"),t=(0,n.fV)(i),{close:o}=(0,n.Le)(i);return(0,s.useMemo)((()=>new r.Z(o).isFinite()?(0,f.uf)(o,t):"-"),[o,t])},S=e=>{const i=c(e,"qty"),t=c(e,"pair"),o=c(e,"entryPrice"),a=c(e,"side"),{index:d}=p(e),{fundingFee:l,holdingFee:u}=L(e),{margin:y}=m(e),{close:g}=(0,n.Le)(t),f=(0,s.useMemo)((()=>"LONG"===a),[a]),P=(0,s.useMemo)((()=>f?new r.Z(g).minus(o).multipliedBy(i).plus(l).dividedBy(d).plus(new r.Z(l).minus(u)):new r.Z(o).minus(g).multipliedBy(i).plus(l).dividedBy(d).plus(new r.Z(l).minus(u))),[o,l,u,d,f,g,i]),v=(0,s.useMemo)((()=>new r.Z(P).dividedBy(y)),[P,y]);return(0,s.useMemo)((()=>({PNL:P,ROI:v})),[P,v])},M=e=>{const{PNL:i,ROI:t}=S(e),{initialed:n,symbol:o,qtyPrecision:r}=m(e);return(0,s.useMemo)((()=>{const e=(0,f.uf)(i,r),s=`${(0,f.uf)(t.multipliedBy(100),2)}%`,a=i.isFinite(),d=t.isFinite(),l=i.isNegative(),u=i.gt(0),c=t.isNegative();return{PNL:n&&a?l?`${e} ${o}`:`+${e} ${o}`:"-",ROI:n&&d?c?s:`+${s}`:"-",PNLAbbr:n&&a?`${l?"-":"+"}${(0,f.pF)(Math.abs(i.toNumber()),r)}`:"-",isPNLNegative:l,isPNLPositive:u,isROINegative:c,marginSymbol:o}}),[i,r,t,n,o])},Z=e=>{const i=c(e,"qty"),t=c(e,"pair"),{close:o}=(0,n.Le)(t);return(0,s.useMemo)((()=>{const e=new r.Z(i).multipliedBy(o);return e.isFinite()?e.toFixed(1):"-"}),[o,i])},F=e=>{const i=c(e,"pair"),t=c(e,"isLong"),{productMap:n}=(0,y.GS)();return(0,s.useMemo)((()=>{var e,s;return{symbol:i,isLong:t,symbolType:null===(e=n[i])||void 0===e?void 0:e.symbolType,symbolName:null===(s=n[i])||void 0===s?void 0:s.symbolName}}),[t,i,n])},N=e=>{const i=c(e,"takeProfit"),t=c(e,"stopLoss"),o=c(e,"pair"),a=(0,n.fV)(o);return(0,s.useMemo)((()=>{const e=new r.Z(i),s=new r.Z(t);return{takeProfit:e.isFinite()?(0,f.uf)(e,a):"-",stopLoss:s.isFinite()&&!s.isEqualTo(0)?(0,f.uf)(s,a):"-"}}),[a,t,i])};var D=t(76398),I=t(4137),E=t(52099),R=t(90322),q=t(45779),A=t(90974);const U=new(t(42405).v);var C=t(59712);const $=()=>{const{track:e}=(0,n.B1)(),{getI18n:i}=(0,A.V6)(),{setDisabled:t}=(0,y.a9)(),{submit:o}=(0,I.t)({getI18n:i}),r=(0,n.E4)(),a="addMargin",{writeAsync:d}=(0,E.GG)(Object.assign(Object.assign({},r),{mode:"recklesslyUnprepared",functionName:a}));(0,s.useEffect)((()=>U.on("ADD_MARGIN",(i=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){const{hash:s,amount:n,closeModalCallBack:l}=i;t(!0),C.debug("ADD_MARGIN",s,n),e("click_add_margin_classic_popup_button");try{const i=[s,n],t=yield(0,R.$q)(Object.assign(Object.assign({},r),{functionName:a,args:i})),{gasLimit:u}=t.request;yield o((()=>null==d?void 0:d({recklesslySetUnpreparedArgs:i,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(u)}})),{onUserConfirm(){null==l||l()}}),e("add_margin_classic_success"),q.ee.emit("REFETCH_POSITION_LIST",void 0)}catch(i){e("add_margin_classic_error")}t(!1)}))))),[r,t,o,e,d])};var j=t(5668),x=t(59712);const G=()=>{const e=d((e=>e.positionMap)),{productMap:i}=(0,y.GS)();return function(e){const i=(0,s.useRef)(e);i.current=e;return(0,s.useCallback)(((...e)=>("function"==typeof i.current?i.current:()=>{})(...e)),[])}((t=>{const{pair:s}=e[t]||{};return s?i[s]?1===i[s].symbolType:(x.error(`useIsDegenMode productMap can not found the pair by hash ${t} and pair ${s}`),!1):(x.error(`useIsDegenMode positionMap can not found the pair by hash ${t}`),!1)}))},H=()=>{const{track:e}=(0,n.B1)(),{getI18n:i}=(0,A.V6)(),{setDisabled:t}=(0,y.a9)(),o=G(),{submit:r}=(0,I.t)({getI18n:i}),a=(0,n.E4)(),d="closeTrade",{writeAsync:l}=(0,E.GG)(Object.assign(Object.assign({},a),{mode:"recklesslyUnprepared",functionName:d}));return(0,s.useCallback)((i=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){t(!0);const s=o(i);e(s?"click_close_degen_position_button":"click_close_classic_position_button");try{const t=[i],n=yield(0,R.$q)(Object.assign(Object.assign({},a),{functionName:d,args:t})),{gasLimit:o}=n.request;yield r((()=>null==l?void 0:l({recklesslySetUnpreparedArgs:t,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(o)}})),{otherParams:{orderHash:i},secondConfirm:j.Xp,secondConfirmAddress:a.address}),e(s?"close_degen_position_success":"close_classic_position_success")}catch(i){e(s?"close_degen_position_error":"close_classic_position_error")}return q.ee.emit("REFETCH_POSITION_LIST",void 0),t(!1),!0}))),[t,o,e,a,r,l])};var V=t(59712);const z=()=>{const{getI18n:e}=(0,A.V6)(),{setDisabled:i}=(0,y.a9)(),{track:t}=(0,n.B1)(),a=(0,n.E4)(),{submit:d}=(0,I.t)({getI18n:e}),{writeAsync:l}=(0,E.GG)(Object.assign(Object.assign({},a),{mode:"recklesslyUnprepared",functionName:"updateTradeTpAndSl"})),{writeAsync:u}=(0,E.GG)(Object.assign(Object.assign({},a),{mode:"recklesslyUnprepared",functionName:"updateTradeTp"})),{writeAsync:c}=(0,E.GG)(Object.assign(Object.assign({},a),{mode:"recklesslyUnprepared",functionName:"updateTradeSl"}));(0,s.useEffect)((()=>U.on("UPDATE_TRADE_TP_SL",(e=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){const{hash:s,takeProfit:n,stopLoss:u,closeModalCallBack:c}=e,m=new r.Z(u);i(!0),V.debug("updateTradeTpAndSl",s,n,u),t("class_position_edit_tpsl");try{const e=[s,(0,o.r0)(n,T.cB.price),m.isEqualTo(0)||!m.isFinite()?0:(0,o.r0)(u,T.cB.price)],i=yield(0,R.$q)(Object.assign(Object.assign({},a),{functionName:"updateTradeTpAndSl",args:e})),{gasLimit:r}=i.request;yield d((()=>null==l?void 0:l({recklesslySetUnpreparedArgs:e,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(r)}})),{onUserConfirm(){null==c||c()}}),t("class_position_edit_tpsl_success"),q.ee.emit("REFETCH_POSITION_LIST",void 0)}catch(e){t("class_position_edit_tpsl_error")}i(!1)}))))),[a,d,l,i,t]),(0,s.useEffect)((()=>U.on("UPDATE_TRADE_TP",(e=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){const{hash:s,takeProfit:n,closeModalCallBack:r}=e;i(!0),V.debug("updateTradeTp",s,n),t("class_position_edit_tpsl");try{const e=[s,(0,o.r0)(n,T.cB.price)],i=yield(0,R.$q)(Object.assign(Object.assign({},a),{functionName:"updateTradeTp",args:e})),{gasLimit:l}=i.request;yield d((()=>null==u?void 0:u({recklesslySetUnpreparedArgs:e,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(l)}})),{onUserConfirm(){null==r||r()}}),t("class_position_edit_tpsl_success"),q.ee.emit("REFETCH_POSITION_LIST",void 0)}catch(e){t("class_position_edit_tpsl_error")}i(!1)}))))),[a,d,u,i,t]),(0,s.useEffect)((()=>U.on("UPDATE_TRADE_SL",(e=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){const{hash:s,stopLoss:n,closeModalCallBack:l}=e,u=new r.Z(n);i(!0),V.debug("updateTradeSl",s,n),t("class_position_edit_tpsl");try{const e=[s,u.isEqualTo(0)||!u.isFinite()?0:(0,o.r0)(n,T.cB.price)],i=yield(0,R.$q)(Object.assign(Object.assign({},a),{functionName:"updateTradeSl",args:e})),{gasLimit:r}=i.request;yield d((()=>null==c?void 0:c({recklesslySetUnpreparedArgs:e,recklesslySetUnpreparedOverrides:{gasLimit:(0,f.zb)(r)}})),{onUserConfirm(){null==l||l()}}),t("class_position_edit_tpsl_success"),q.ee.emit("REFETCH_POSITION_LIST",void 0)}catch(e){t("class_position_edit_tpsl_error")}i(!1)}))))),[a,d,c,i,t])},Q=()=>(0,s.useMemo)((()=>({updateTpAndSl:({hash:e,takeProfit:i,stopLoss:t},s)=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){U.emit("UPDATE_TRADE_TP_SL",{hash:e,takeProfit:i,stopLoss:t,closeModalCallBack:s})})),updateTp:({hash:e,takeProfit:i},t)=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){U.emit("UPDATE_TRADE_TP",{hash:e,takeProfit:i,closeModalCallBack:t})})),updateSl:({hash:e,stopLoss:i},t)=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){U.emit("UPDATE_TRADE_SL",{hash:e,stopLoss:i,closeModalCallBack:t})}))})),[]);var J=t(91449);const K=e=>e.map((e=>{const i={positionHash:e.positionHash,pair:e.pair.replace("/",""),pairBase:e.pairBase,marginToken:e.marginToken,isLong:e.isLong,hash:e.positionHash,entryPrice:(0,o.mb)(e.entryPrice.toString(),T.cB.price),qty:(0,o.mb)(e.qty.toString(),T.cB.qty),stopLoss:(0,o.mb)(e.stopLoss.toString(),T.cB.price),takeProfit:(0,o.mb)(e.takeProfit.toString(),T.cB.price),timestamp:`${e.timestamp}000`,side:e.isLong?"LONG":"SHORT",margin:e.margin.toString(),executionFee:e.executionFee.toString(),fundingFee:e.fundingFee.toString(),openFee:e.openFee.toString(),holdingFee:e.holdingFee.toString(),tokenIn:e.tokenIn};return Object.assign(Object.assign({},e),i)})).sort(((e,i)=>Number(i.timestamp)-Number(e.timestamp))),W=()=>{const e=(0,n.E4)(),{address:i,isConnected:t}=(0,E.mA)(),o=u(),r=d((e=>e.initialPositions)),{data:a=[],refetch:l,isSuccess:c,isFetching:m}=(0,E.do)(Object.assign(Object.assign({},e),{functionName:"getPositionsV2",args:[i,"0x0000000000000000000000000000000000000000"],enabled:t,cacheOnBlock:!0,cacheTime:J.g_}));(0,s.useEffect)((()=>{t||r([])}),[r,t]),(0,s.useEffect)((()=>{c&&!o&&r(K(a))}),[a,r,c,o]),(0,s.useEffect)((()=>{o&&!m&&r(K(a))}),[a,r,m,o]),(0,s.useEffect)((()=>q.ee.on("REFETCH_POSITION_LIST",(()=>{l()}))),[l])},X=e=>{const{close:i}=(0,n.Le)(e);return(0,s.useMemo)((()=>i),[i])};var Y=t(48042);const ee=()=>(0,s.useMemo)((()=>({addMargin:({hash:e,amount:i,closeModalCallBack:t})=>(0,D.__awaiter)(void 0,void 0,void 0,(function*(){U.emit("ADD_MARGIN",{hash:e,amount:i,closeModalCallBack:t})}))})),[]),ie=e=>{const{getI18n:i}=(0,A.V6)(),t=c(e,"qty"),o=c(e,"isLong"),a=c(e,"entryPrice"),d=c(e,"pair"),{index:l}=p(e),u=w(e),{fundingFee:y}=O(e),g=(0,n.fV)(d),{marginToken:P,margin:v,qtyPrecision:B}=m(e),b=(0,s.useCallback)((e=>new r.Z(v).plus(e)),[v]),_=(0,s.useCallback)((e=>new r.Z(t).multipliedBy(a).dividedBy(new r.Z(e).multipliedBy(l))),[a,l,t]),L=(0,s.useCallback)((e=>{const i=new r.Z(e).multipliedBy(u).multipliedBy(l).plus(y).dividedBy(t);return o?new r.Z(a).minus(i):new r.Z(a).plus(i)}),[a,y,l,o,u,t]);return(0,s.useMemo)((()=>({symbol:d,side:o?i("userinfo-positions-side-LONG","Long"):i("userinfo-positions-side-SHORT","Short"),isLong:o,marginToken:P,marginQtyPrecision:B,pricePrecision:g,formatNumber:f.uf,calcMargin:b,calcLeverage:_,calcLiqPrice:L,useTokenApprove:Y.Z,useContractAddMargin:ee})),[d,o,i,P,B,g,b,_,L])};var te=t(46970);const se=e=>{const i=c(e,"timestamp"),{getI18n:t}=(0,A.V6)();return(0,s.useMemo)((()=>(0,f.jE)(Number(i),t)),[i,t])},ne=e=>{const{fundingFee:i,holdingFee:t}=L(e),{fundingFee:n,holdingFee:o}=O(e),{symbol:a,qtyPrecision:d}=m(e);return(0,s.useMemo)((()=>{const e=new r.Z(i).minus(t);return{fundingFee:`${e.isNegative()?"":"+"}${(0,f.FL)(e,d)} ${a} ( ≈ ${(0,f.uf)(new r.Z(n).minus(o),2)} USD )`,isFundingFeeNegative:e.isNegative()}}),[i,t,d,a,n,o])},oe=e=>{const{symbol:i,qtyPrecision:t}=m(e),n=(e=>{const{margin:i}=m(e);return(0,s.useMemo)((()=>i),[i])})(e),{margin:o}=B(e);return(0,s.useMemo)((()=>`${(0,f.FL)(n,t)} ${i} ( ≈ ${(0,f.uf)(o,1)} USD )`),[n,t,i,o])},re=e=>{const{PNL:i}=S(e),{openFee:t,executionFee:s}=L(e);return i.minus(t).minus(s)},ae=e=>{const{symbol:i,qtyPrecision:t}=m(e),n=re(e),o=(e=>{const i=re(e),{index:t}=p(e);return i.multipliedBy(t)})(e);return(0,s.useMemo)((()=>({netProfit:n.isNaN()?"-":`${n.isNegative()?"":"+"}${(0,f.FL)(n,t)} ${i} ( ≈ ${(0,f.uf)(o,1)} USD )`,isNetProfitNegative:n.isNegative()})),[n,t,i,o])},de=e=>{const{openFee:i,executionFee:t}=L(e),{openFee:n,executionFee:o}=O(e),{symbol:a,qtyPrecision:d}=m(e);return(0,s.useMemo)((()=>`${(0,f.FL)(new r.Z(i).plus(t),d)} ${a} ( ≈ ${(0,f.uf)(n.plus(o),2)} USD )`),[i,t,d,a,n,o])},le=e=>{const i=c(e,"pair"),t=(0,y.Lh)(i,"baseAsset");return(0,s.useMemo)((()=>({pair:i,baseAsset:t})),[i,t])},ue=e=>{const{symbol:i,qtyPrecision:t}=m(e),{index:n}=p(e),{PNL:o,ROI:r}=S(e);return(0,s.useMemo)((()=>{const e=(0,f.FL)(o,t),s=`${(0,f.uf)(r.multipliedBy(100),2)}%`,a=o.isFinite(),d=r.isFinite(),l=o.isNegative(),u=o.gt(0),c=r.isNegative();return{PNL:a?`${l?"":"+"}${e} ${i} ( ≈ ${(0,f.uf)(o.multipliedBy(n),1)} USD\n      )`:"-",PNLOrigin:o,PNLFormatted:e,ROI:d?c?s:`+${s}`:"-",isPNLNegative:l,isPNLPositive:u,isROINegative:c,marginSymbol:i}}),[o,r,t,n,i])},ce=e=>{const i=c(e,"margin"),t=c(e,"marginToken"),a=(0,n.QG)(t),d=L(e);return(0,s.useMemo)((()=>new r.Z((0,o.mb)(i,a)).plus(d.openFee).plus(d.executionFee)),[d,i,a])},me=e=>{const i=ce(e),t=(e=>{const i=ce(e),{index:t}=p(e);return i.multipliedBy(t)})(e),{symbol:n,qtyPrecision:o}=m(e);return(0,s.useMemo)((()=>`${(0,f.FL)(i,o)} ${n} ( ≈ ${(0,f.uf)(t,1)} USD )`),[i,o,n,t])},pe=e=>{const i=Z(e),t=c(e,"qty"),n=c(e,"pair"),o=(0,y.Lh)(n,"quantityPrecision");return(0,s.useMemo)((()=>({size:i,qty:(0,f.uf)(t,o)})),[t,o,i])},ye=()=>{const{track:e}=(0,te.B)(),i=(0,s.useCallback)((i=>{e(i?"pv_degen_position_detail_popup":"pv_classic_position_detail_popup")}),[e]);return(0,s.useMemo)((()=>({usePositionDetailPair:le,usePositionDetailLeverage:_,usePositionDetailInitialMargin:oe,usePositionDetailPrincipal:me,usePositionDetailSymbol:F,usePositionDetailQtyAndSize:pe,usePositionDetailFundingFee:ne,usePositionDetailOpenFee:de,usePositionDetailEntryPrice:v,usePositionDetailLiquidPrice:h,usePositionDetailLiqLostRate:w,usePositionDetailPNLROI:ue,usePositionDetailNetProfit:ae,usePositionDetailDuration:se,usePositionDetailPricePrecision:n.fV,useIsDegenMode:G})),[i])};var ge=t(59629);const fe=e=>{const i=c(e,"qty"),t=c(e,"entryPrice"),a=c(e,"side"),d=c(e,"pair"),l=c(e,"takeProfit"),u=c(e,"stopLoss"),y=(0,n.fV)(d),g=b(e),{fundingFee:P}=O(e),{data:v}=(0,n.VT)(),B=w(e),{index:_}=p(e),{qtyPrecision:L,symbol:h}=m(e),k=(0,s.useMemo)((()=>"LONG"===a),[a]),S=(0,s.useMemo)((()=>L),[L]),M=(0,s.useMemo)((()=>2),[]),Z=(0,s.useMemo)((()=>k?(null==v?void 0:v.maxTakeProfitP)?(0,o.mb)(v.maxTakeProfitP,T.cB.percent):"Infinity":(null==v?void 0:v.maxTakeProfitP)?r.Z.minimum(new r.Z(g),(0,o.mb)(v.maxTakeProfitP,T.cB.percent)).toString():"Infinity"),[k,g,null==v?void 0:v.maxTakeProfitP]),F=(0,ge.D)((e=>k?new r.Z(e).multipliedBy(_).minus(P).dividedBy(i).plus(t):new r.Z(t).minus(new r.Z(e).multipliedBy(_).minus(P).dividedBy(i)))),N=(0,ge.D)((e=>k?new r.Z(e).minus(t).multipliedBy(i).plus(P).dividedBy(_):new r.Z(t).minus(e).multipliedBy(i).plus(P).dividedBy(_))),D=(0,ge.D)((e=>new r.Z(i).multipliedBy(t).multipliedBy(e).dividedBy(g).dividedBy(_))),I=(0,ge.D)((e=>new r.Z(e).multipliedBy(_).multipliedBy(g).dividedBy(new r.Z(i).multipliedBy(t)))),E=(0,ge.D)((e=>k?new r.Z(e).multipliedBy(_).minus(P).dividedBy(i).plus(t):new r.Z(t).minus(new r.Z(e).multipliedBy(_).minus(P).dividedBy(i)))),R=(0,ge.D)((e=>k?new r.Z(e).minus(t).multipliedBy(i).plus(P).dividedBy(_):new r.Z(t).minus(e).multipliedBy(i).plus(P).dividedBy(_))),q=(0,ge.D)((e=>new r.Z(i).multipliedBy(t).multipliedBy(e).dividedBy(g).dividedBy(_))),A=(0,ge.D)((e=>new r.Z(e).multipliedBy(_).multipliedBy(g).dividedBy(new r.Z(i).multipliedBy(t)))),U=(0,ge.D)((e=>`${(0,f.uf)(e,S)} ${h}`)),C=(0,ge.D)((e=>(0,f.uf)(e,M))),$=(0,ge.D)((e=>(0,f.uf)(e,y)));return(0,s.useMemo)((()=>({getTakeProfitPrice:F,getTakeProfitPNL:N,getTakeProfitPNLByROI:D,getTakeProfitROI:I,getStopLossPrice:E,getStopLossPNL:R,getStopLossPNLByROI:q,getStopLossROI:A,pair:d,takeProfit:l,stopLoss:u,pricePrecision:y,PNLPrecision:S,ROIPrecision:M,maxTakeProfitROI:Z,minStopLossROI:(-B).toString(),side:a,entryPrice:t,formatPNL:U,formatROI:C,formatPrice:$,useContractUpdateTPSL:Q})),[S,M,t,U,$,C,R,q,E,A,N,D,F,I,Z,B,d,y,a,u,l])}},58921:(e,i,t)=>{t.d(i,{T:()=>s});const s={positions:"positions",orders:"orders",history:"history"}}}]);