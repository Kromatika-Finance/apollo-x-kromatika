"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[603],{61603:(e,t,r)=>{r.r(t),r.d(t,{default:()=>A});var n=r(52322),i=r(2784),s=r(75486),c=r.n(s),o=r(1851),a=r(98492),u=r(436),l=r(3707),y=r(57005),m=r(671),p=(r(86067),r(4673)),d=r(70993),v=r(51609),b=r(66747),f=r(20115),k=r(21414),T=r(72869),h=r(14279),g=r(40943),M=r(94190),D=r(84972),I=r(25072),O=r(31161);const S=({symbol:e,type:t,priceType:r})=>`${e}@${t}@${r}`,x=e=>{const[t,r,n]=e.split("@");return{symbol:t,type:r,priceType:n}};var C=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function c(e){try{a(n.next(e))}catch(e){s(e)}}function o(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(c,o)}a((n=n.apply(e,t||[])).next())}))};const{brandName:P=""}=window.brokerConfig,j=[p.ls.TRADING,p.ls.DELIVERING];var w;!function(e){e.Futures="futures",e.FuturesMark="futures-mark",e.FuturesIndex="futures-index",e.Delivery="delivery",e.DeliveryMark="delivery-mark",e.DeliveryIndex="delivery-index"}(w||(w={}));const F=({ticker:e,name:t,productType:r,pricePrecision:n})=>({name:t,fullName:t,description:t,ticker:e,tickSize:Math.pow(10,n),exchange:P,supportedResolutions:o.k.DefaultResolutions,type:r});var V=r(45873);var $=r(23716),L=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function c(e){try{a(n.next(e))}catch(e){s(e)}}function o(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(c,o)}a((n=n.apply(e,t||[])).next())}))};const R="myTradingView",E=e=>{[l.sy,l.O7].map((e=>c().createInstance({name:e}))).forEach((t=>t.setItem(R,e)))},A=({symbol:e,namespace:t,useMiniTicker:r=!1})=>{const s=o.k.Store.createStore(t),l=s(o.k.Store.getTrueInterval),[p]=s(o.k.Store.getPriceType),A=(0,a.Vh)(),{contractType:q}=A[e]||{},{datafeed:B,symbolsInfo:U}=(({namespace:e,useMiniTicker:t=!1})=>{const r=o.k.Store.createStore(e),{getI18n:n}=(0,d.ZK)("trd-chart","trade-ui"),{getI18n:s}=(0,d.yk)(),c=(0,a.Vh)(),u=(0,i.useRef)(c),{isContUnit:l}=(0,O.Q)(),y=(0,a._n)(),[m]=r(o.k.Store.getPriceType),p=(0,i.useRef)(y),v=(0,i.useRef)(m);u.current=c,p.current=y,v.current=m;const b=(0,i.useMemo)((()=>l?I.D:I.V),[l]),f=(0,i.useMemo)((()=>s("usdtFutures-13",{defaultValue:"Futures"})||""),[s]),k=(0,i.useMemo)((()=>s("inverseFutures-13",{defaultValue:"Delivery"})||""),[s]),V=(0,i.useMemo)((()=>n("indexPrice",{defaultValue:"Index Price"})||""),[n]),$=(0,i.useMemo)((()=>n("markPrice",{defaultValue:"Mark Price"})||""),[n]),L=(0,i.useMemo)((()=>n("lastPrice",{defaultValue:"Last Price"})||""),[n]),R=(0,i.useMemo)((()=>({exchanges:[{name:P,value:P,desc:""}],symbols_types:[{name:f,value:w.Futures},{name:`${f} ${$}`,value:w.FuturesMark},{name:`${f} ${V}`,value:w.FuturesIndex}]})),[k,f,V,$]),E=(0,i.useCallback)((()=>C(void 0,void 0,void 0,(function*(){try{yield(({checker:e,interval:t=1e3,timeout:r=1e4})=>{let n;return Promise.race([new Promise((r=>{n=setInterval((()=>e()&&r()),t)})),new Promise(((e,t)=>{setTimeout((()=>t(new Error("timeout"))),r)}))]).finally((()=>clearInterval(n)))})({checker:()=>Object.keys(u.current).length>0})}catch(e){}const e=u.current;return Object.keys(e).reduce(((t,r)=>{const{symbol:n,pricePrecision:i,isDelivery:c,contractStatus:a,contractType:u}=e[r];if(!j.includes(a))return t;const{symbol:l,contractTypeI18n:y,deliveryDateFormat:m}=(0,T.H)(e[r],s),p=`${l} ${y}${m?` ${m}`:""}`,d=S({symbol:n,type:u,priceType:o.k.Store.PriceType.Last}),v=S({symbol:n,type:u,priceType:o.k.Store.PriceType.Index}),b=S({symbol:n,type:u,priceType:o.k.Store.PriceType.Mark});return t[d]=F({ticker:d,name:`${p} ${L}`,productType:c?w.Delivery:w.Futures,pricePrecision:i}),t[v]=F({ticker:v,name:`${p} ${V}`,productType:c?w.DeliveryIndex:w.FuturesIndex,pricePrecision:i}),t[b]=F({ticker:b,name:`${p} ${$}`,productType:c?w.DeliveryMark:w.FuturesMark,pricePrecision:i}),t}),{})}))),[s,V,$,L]),A=(0,i.useCallback)((({symbolInfo:e,resolution:t,rangeStartDate:r,rangeEndDate:n})=>C(void 0,void 0,void 0,(function*(){const i=u.current,{symbol:s="",priceType:c=v.current}=x(e.ticker||""),{pair:a,contractType:l,contractVal:y,isDelivery:m}=i[s],p=Math.max(0,1e3*r),d=1e3*n,f=o.k.utils.TVResolutionToTrueInterval[t],k=m?b(y):e=>e,T=(0,D.b)({symbol:s,pair:a,contractType:l,interval:f,isDelivery:m,priceType:c});return(yield(0,M.M)({onFetchKlineData:T,startTime:p,endTime:d})).map(k)}))),[b]),q=(0,i.useCallback)((({symbolInfo:e,resolution:r,callback:n})=>{const i=u.current,{symbol:s="",priceType:c=v.current}=x(e.ticker||""),{pair:a,contractType:l,contractVal:y,isDelivery:m}=i[s],p=o.k.utils.TVResolutionToTrueInterval[r],d=m?b(y):e=>e;return(0,g.Ld)({symbol:s,pair:a,contractType:l,interval:p,priceType:c,isDelivery:m,useMiniTicker:t,checkIfInSync:()=>!0,callback:e=>n(d(e))})}),[b,t]),B=(0,i.useCallback)((()=>C(void 0,void 0,void 0,(function*(){const{serverTime:e}=yield(0,h.b)(!0);return Math.floor(parseInt(`${e}`,10)/1e3)}))),[]),U=(0,i.useMemo)((()=>o.k.createDatafeed()),[]),{datafeed:_,symbolsInfo:N}=U({config:R,onFetchSymbolsInfo:E,onFetchBars:A,onSubscribeBars:q,onFetchServerTimeApi:B});return{datafeed:_,symbolsInfo:N}})({namespace:t,useMiniTicker:r}),_=(0,a.Fg)(),N="light"===_?m.ib:m.Cs,H=(0,y.k)(_),K=(0,i.useMemo)((()=>c().createInstance({name:t})),[t]),Q=(0,i.useMemo)((()=>S({symbol:e,type:q,priceType:p})),[e,q,p]),G=(0,i.useRef)(-1),{executionOrders:W}=(({symbol:e,namespace:t})=>{const r=o.k.OrderHistoryStore.createStore(t),[n]=r(o.k.OrderHistoryStore.getOrderHistory),{getI18n:s}=(0,d.KL)(),c=(({symbol:e})=>{const{getI18n:t}=(0,v.yk)(),r=(0,f.AM)(),{baseAsset:n,marginAsset:i,isDelivery:s}=r[e]||{},{unit:c}=(0,k.F7)();return s?c===b.SW.coin?n:t("Cont"):c===b.AO.usdt?i:n})({symbol:e}),u=(0,a.AM)(),{baseAsset:l,pricePrecision:y,quantityPrecision:m,equalQtyPrecision:p,isDelivery:T,contractVal:h}=u[e]||{},g=(0,i.useMemo)((()=>s("openOrder-sideBuyBOTH",{defaultValue:"Buy"})||""),[s]),M=(0,i.useMemo)((()=>s("openOrder-sideSellBOTH",{defaultValue:"Sell"})||""),[s]),D=(0,i.useMemo)((()=>{switch(c){case l:return T?p:m;default:return T?m:y}}),[T,c,l,p,y,m]),I=(0,i.useCallback)((({avgPrice:e,executedQty:t})=>T?(0,V.GW)(c===l?(({price:e,cont:t,contractVal:r})=>t*r/e)({price:e,cont:t,contractVal:h}):t,D):(0,V.mD)(c===l?t:t*e,D)),[l,h,T,D,c]);return{executionOrders:(0,i.useMemo)((()=>n.filter((({status:e,executedQty:t})=>"FILLED"===e.toUpperCase()||"PARTIAL FILL"===e.toUpperCase()||"PARTIALLY_FILLED"===e.toUpperCase()||"EXPIRED"===e.toUpperCase()&&t>0||"CANCELED"===e.toUpperCase()&&t>0)).map((({id:e,avgPrice:t,side:r,time:n,executedQty:i})=>{const s=`${"BUY"===r?g:M} ${I({avgPrice:t,executedQty:i})} @ ${(+t).toFixed(y)}`;return{id:e,text:"",price:+t,quantity:"",time:Math.round(n/1e3),isBuy:"BUY"===r,tooltip:s}}))),[n,g,M,I,y])}})({symbol:e,namespace:t});(0,u.M)(e,r),(0,u.j)({symbol:e,interval:l,priceType:p});const Y=(0,i.useCallback)((()=>{G.current=Date.now()}),[]),X=(0,i.useCallback)((e=>L(void 0,void 0,void 0,(function*(){return E(e)}))),[]),Z=(0,i.useCallback)((()=>{}),[]),z=(0,i.useCallback)((()=>L(void 0,void 0,void 0,(function*(){const e=yield K.getItem(R);E(e)}))),[K]),J=(0,i.useCallback)((e=>$.log("tv-error",e)),[]),ee=(0,i.useCallback)((()=>{}),[]),te=(0,i.useCallback)((()=>{}),[]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(o.k.Containers.TradingView,{namespace:t,theme:N,storageName:R,tradingViewProps:{symbol:Q,symbolsInfo:U,theme:H,limitOrders:[],positionOrders:[],executionOrders:W,initialConfig:{tvConfig:{library_path:"charting_library_next/",symbol:Q,theme:H,datafeed:B},onScriptLoaded:Y,onSave:X,onChartReadyDone:Z,onWillUnmount:z,onCreateOrderShapesError:J,onFirstTimeDataLoadedDone:ee,onSetThemeDone:te}}},void 0)},void 0)}},436:(e,t,r)=>{r.d(t,{j:()=>o,M:()=>a});var n=r(2784),i=r(1851),s=r(4673),c=r(20115);const o=({symbol:e,interval:t,priceType:r})=>{const{pair:o,contractType:a,isDelivery:u}=(0,c.Vh)()[e]||{},l=(0,n.useRef)();(0,n.useEffect)((()=>{if(!o||!a)return()=>null;const n="mark"===r?e:o;return l.current=void 0,i.k.utils.intervalToMillseconds(t),(u?(0,s.RU)():(0,s.BN)()).getContinuousKlineStream(n,a,t,{priceType:r,symbol:e}).subscribe((e=>{l.current&&(e.time,l.current.time),l.current=e}))}),[o,e,t,a,r,u])},a=(e,t)=>{const{isDelivery:r}=(0,c.Vh)()[e]||{},i=(0,n.useRef)();(0,n.useEffect)((()=>t?()=>null:(r?(0,s.RU)():(0,s.BN)()).getStreamTradeSnap(e).subscribe((e=>{const t=e[e.length-1];i.current&&(t.tradeTime,i.current.tradeTime),i.current=t}))),[r,e,t])}},84972:(e,t,r)=>{r.d(t,{b:()=>i});var n=r(6590);const i=({symbol:e,pair:t,contractType:r,interval:i,isDelivery:s,priceType:c})=>o=>s&&"last"===c?(0,n.kV)(Object.assign(Object.assign({},o),{pair:t,contractType:r,interval:i})):s&&"mark"===c?(0,n.uX)(Object.assign(Object.assign({},o),{symbol:e,interval:i})):s&&"index"===c?(0,n.te)(Object.assign(Object.assign({},o),{pair:t,interval:i})):"mark"===c?(0,n.C1)(Object.assign(Object.assign({},o),{symbol:e,interval:i})):"index"===c?(0,n.hH)(Object.assign(Object.assign({},o),{pair:t,interval:i})):(0,n.MZ)(Object.assign(Object.assign({},o),{pair:t,contractType:r,interval:i}))},94190:(e,t,r)=>{r.d(t,{M:()=>n});const n=({onFetchKlineData:e,startTime:t,endTime:r,limit:n=1e3})=>{return i=void 0,s=void 0,o=function*(){const i=[];let s=[],c=r;const o=0!==r;do{if(s=yield e(Object.assign(Object.assign({},0===c?{}:{endTime:c}),{limit:n})),0===s.length)break;s.forEach((([e,t,r,n,s,c,,o])=>{i.push({time:+e,open:+t,high:+r,low:+n,close:+s,volume:+c,quantity:+o})})),c=s[0][0]-1}while(s.length===n&&c>t&&o);return i.sort(((e,t)=>e.time-t.time)),i},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{a(o.next(e))}catch(e){t(e)}}function n(e){try{a(o.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof c?i:new c((function(e){e(i)}))).then(r,n)}a((o=o.apply(i,s||[])).next())}));var i,s,c,o}},25072:(e,t,r)=>{r.d(t,{D:()=>i,V:()=>n});const n=e=>t=>Object.assign(Object.assign({},t),{volume:t.quantity,quantity:t.volume*e}),i=e=>t=>Object.assign(Object.assign({},t),{volume:t.volume,quantity:t.volume*e})},40943:(e,t,r)=>{r.d(t,{Ld:()=>a});var n=r(1851),i=r(4673),s=r(23716);const c=e=>e,o=e=>e,a=({symbol:e,pair:t,contractType:r,interval:a,priceType:u,isDelivery:l,useMiniTicker:y,callback:m,checkIfInSync:p=(()=>!0)})=>{const d=(0,i.BN)(),v="mark"===u?e:t,b=d.getContinuousKlineStream(v,r,a,{priceType:u,symbol:e});b.selector=c;const f=y?d.getStreamTickers():d.getStreamTradeSnap(e);f.selector=y?(e=>t=>t[e])(e):o;const k=function(e=[]){const t=[];function r(){t.forEach((e=>e()))}return r.subscribe=function(r){const n=[];e.forEach(((e,i)=>{const s=e.subscribe((t=>{n[i]=e.selector(t),r(n)}));t.push(s)}))},r}([b,f]);return k.subscribe((([e,t])=>{if(!t||!e||!p())return;const r=Object.assign({},e);if("last"===u){const e=Array.isArray(t)?t.slice(-1).pop():t,i=n.k.utils.intervalToMillseconds(a),c=+(e.price||e.lastPrice),o=+(e.quantity||e.quoteVolume),u=e.tradeTime||e.eventTime;try{if("1M"===a){const e=new Date(u),t=new Date(r.time).getMonth();if(e.getMonth()>t){const e=+new Date(r.time).setMonth(t+1);Object.assign(r,Object.assign({time:e,open:c,high:c,low:c,close:c},y?{volume:0,quantity:0}:{volume:o,quantity:o}))}}else if(u-r.time>i){const e=r.time+Math.floor((u-r.time)/i)*i;Object.assign(r,Object.assign({time:e,open:c,high:c,low:c,close:c},y?{volume:0,quantity:0}:{volume:o,quantity:o}))}}catch(e){s.error(e)}r.close=c}m(r,e)})),k}}}]);