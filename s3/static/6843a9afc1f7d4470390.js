"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[1688],{90614:(e,i,t)=>{t.d(i,{gN:()=>r,QV:()=>o.Q});var o=t(27657),n=t(2784),s=t(23131);function r(){const[e,i]=(0,n.useState)({});return(0,n.useEffect)((()=>(0,s.RU)().getContractInfoStream().subscribe((e=>{i(e)}))),[]),e}t(55606),t(93954),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature},93954:(e,i,t)=>{t.d(i,{s:()=>p});var o,n=t(2784),s=t(27657),r=t(26786),a=t(48752),l=t(97060);e=t.hmd(e),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&o(e);var c,d,u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},p=function(e){var i=(0,l.yk)().getI18n,t=(0,s.Q)().isCoinUnit,o=e||{},c=o.contractVal,d=o.equalQtyPrecision,u=o.precision,p=(0,n.useCallback)((function(e){var i=e.quantity,o=e.price,n=e.func,s=void 0===n?r.mD:n,l=e.format,u=void 0===l||l;return t?(0,a.unitChangeCoinQty)({quantity:i,price:o,contractVal:c,precision:d,func:s,format:u}):i}),[c,d,t]),m=(0,n.useCallback)((function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"marginAsset";return t?e[o]:i("Cont",{defaultValue:"Cont"})}),[i,t,e]),v=(0,n.useCallback)((function(){return t?d:u}),[d,t,u]);return(0,n.useMemo)((function(){return{getQuantity:p,getAssetLabel:m,getPrecision:v}}),[m,v,p])};u(p,"useFuturesLanguage{{ getI18n: getFuturesI18n }}\nusePreferenceUnit{{ isCoinUnit }}\nuseCallback{getQuantity}\nuseCallback{getAssetLabel}\nuseCallback{getPrecision}\nuseMemo{}",(function(){return[l.yk,s.Q]})),(c="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(c.register((function(e){var i=e.quantity,t=e.price,o=e.contractVal;return Math.floor(i*t/o)}),"unitChangeCoinToCont","/flow/src/git.toolsfdg.net/mono/mono/web/apps/cloud-trade-sdk/src/delivery/hooks/useUnitChange.js"),c.register(p,"useUnitChange","/flow/src/git.toolsfdg.net/mono/mono/web/apps/cloud-trade-sdk/src/delivery/hooks/useUnitChange.js")),(d="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&d(e)},18687:(e,i,t)=>{var o,n,s;function r(e){return Number.isNaN(e)||Math.abs(e)===1/0}function a(e){var i,t,o=e.quantity,n=e.isBuy,s=e.entryPrice,a=void 0===s?0:s,l=e.closedPrice,c=void 0===l?0:l,d=e.contractVal,u=void 0===d?100:d,p=e.isDelivery,m=e.askPrice,v=e.bidPrice,x=n?1:-1;return p?(i=o?(1/a-1/(n?v:m))*o*u*x:0,t=o?(1/a-1/c)*o*u*x:0):(i=o?((n?v:m)-a)*o*x:0,t=(c-a)*o*x),{marketPNL:r(i)?"-":i,limitPNL:r(t)?"-":t}}t.d(i,{k:()=>a}),e=t.hmd(e),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&o(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature,(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(n.register(r,"isIllegalNumber","/flow/src/git.toolsfdg.net/mono/mono/web/apps/cloud-trade-sdk/src/futures/utils/estimatedPNL.js"),n.register(a,"calcEstimatedPNL","/flow/src/git.toolsfdg.net/mono/mono/web/apps/cloud-trade-sdk/src/futures/utils/estimatedPNL.js")),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&s(e)},31793:(e,i,t)=>{t.d(i,{Z:()=>r});var o=t(5163),n=t(2784),s=t(98569);const r=function(e){return n.createElement(s.Z,(0,o.__assign)({width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 16 24"},e),n.createElement("path",{d:"M5.957 11.253a.7.7 0 01-.546-1.137l2.042-2.553a.7.7 0 011.094 0l2.042 2.553a.7.7 0 01-.546 1.137H5.957zm0 1.494a.7.7 0 00-.546 1.137l2.042 2.553a.7.7 0 001.094 0l2.042-2.553a.7.7 0 00-.546-1.137H5.957z"}))}},30105:(e,i,t)=>{t.d(i,{Z:()=>r});var o=t(5163),n=t(2784),s=t(98569);const r=function(e){return n.createElement(s.Z,(0,o.__assign)({width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 16 24"},e),n.createElement("path",{fill:"#7E9AFF",d:"M5.957 12.747a.7.7 0 00-.546 1.137l2.042 2.553a.7.7 0 001.094 0l2.042-2.553a.7.7 0 00-.546-1.137H5.957z"}),n.createElement("path",{fill:"currentColor",d:"M5.957 11.253a.7.7 0 01-.546-1.137l2.042-2.553a.7.7 0 011.094 0l2.042 2.553a.7.7 0 01-.546 1.137H5.957z"}))}},35626:(e,i,t)=>{t.d(i,{Z:()=>r});var o=t(5163),n=t(2784),s=t(98569);const r=function(e){return n.createElement(s.Z,(0,o.__assign)({width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 16 24"},e),n.createElement("path",{fill:"#7E9AFF",d:"M5.957 11.253a.7.7 0 01-.546-1.137l2.042-2.553a.7.7 0 011.094 0l2.042 2.553a.7.7 0 01-.546 1.137H5.957z"}),n.createElement("path",{fill:"currentColor",d:"M5.957 12.747a.7.7 0 00-.546 1.137l2.042 2.553a.7.7 0 001.094 0l2.042-2.553a.7.7 0 00-.546-1.137H5.957z"}))}},46502:(e,i,t)=>{t.d(i,{N:()=>s});var o=t(5163),n=t(2784);function s(e,i,t){var s,r=(0,n.useRef)(0),a=(s=(0,n.useRef)(!1),(0,n.useEffect)((function(){return s.current=!0,function(){s.current=!1}}),[]),(0,n.useCallback)((function(){return s.current}),[])),l=(0,n.useState)(Date.now()),c=l[0],d=l[1],u=(0,n.useState)((0,o.__assign)({loading:!0,updateTime:Date.now()},t)),p=u[0],m=u[1];return(0,n.useEffect)((function(){var i=++r.current;!1===p.loading&&m((0,o.__assign)((0,o.__assign)({},p),{loading:!0})),e().then((function(e){var o=null==e?null==t?void 0:t.value:e;a()&&i===r.current&&m({value:o,loading:!1,error:null,updateTime:Date.now()})})).catch((function(e){a()&&i===r.current&&m((0,o.__assign)((0,o.__assign)({},t),{loading:!1,error:e,updateTime:Date.now()}))}))}),(0,o.__spreadArray)((0,o.__spreadArray)([],i),[c])),(0,o.__assign)((0,o.__assign)({},p),{onRefresh:function(){return d(Date.now)}})}},30068:(e,i,t)=>{t.d(i,{Z:()=>r});var o=t(5163),n=t(2784),s=t(98569);const r=function(e){return n.createElement(s.Z,(0,o.__assign)({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none"},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.288 12l-3.89 3.89 1.768 1.767L15.823 12l-1.768-1.768-3.889-3.889-1.768 1.768 3.89 3.89z",fill:"currentColor"}))}},32027:(e,i,t)=>{t.d(i,{Z:()=>r});var o=t(5163),n=t(2784),s=t(98569);const r=function(e){return n.createElement(s.Z,(0,o.__assign)({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none"},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 21a9 9 0 100-18 9 9 0 000 18zm-1.25-5.5V18h2.5v-2.5h-2.5zm0-9.5v7h2.5V6h-2.5z",fill:"currentColor"}))}},71787:(e,i,t)=>{t.d(i,{Z:()=>x});var o=t(5163),n=t(2784),s=t(50464),r=t(87938),a=t(62143),l=t(53858),c=t(53021),d=t(68106),u=t(35395),p=t(28776),m=t(80142),v=function(){return"undefined"!=typeof window?document.body.offsetHeight:0};const x=n.forwardRef((function(e,i){var t=this,x=e.arrow,g=void 0!==x&&x,h=e.boundary,b=e.delay,y=void 0===b?0:b,f=e.container,j=e.tip,k=e.placement,O=e.pos,P=e.children,C=e.open,S=e.trigger,w=void 0===S?"hover":S,T=e.scroll,M=void 0===T||T,K=e.resize,N=void 0===K||K,z=e.enablePortal,Z=void 0!==z&&z,I=e.leaveDelay,R=void 0===I?0:I,L=e.boxOffset,A=void 0===L?0:L,V=e.arrowPadding,q=void 0===V?0:V,E=e.onlyShowOnHover,_=void 0===E||E,D=e.onClickOutside,U=e.clickOutsideClose,F=e.bg;k=k||O||"top",k="rtl"===(0,l.Z)()?p.O9[k]:k;var H=n.useRef(null!=C).current,$=n.useRef(null),B=(0,n.useState)(null),Q=B[0],W=B[1],G=(0,n.useState)(null),Y=G[0],J=G[1],X=(0,n.useState)(null),ee=X[0],ie=X[1],te=n.useRef(0),oe=n.useRef(0),ne=(0,c.D)(Q,Y,{placement:k,modifiers:[{name:"eventListeners",options:{scroll:M,resize:N}},{name:"arrow",options:{element:ee,padding:q}},{name:"offset",options:{offset:[A||0,p.SG]}},{name:"computeStyles",options:{adaptive:!1,gpuAcceleration:!1}},{name:"flip",options:{boundary:h}}]}),se=ne.styles,re=ne.attributes,ae=ne.update,le=ne.state,ce=n.useMemo((function(){return(0,p.BP)(null==le?void 0:le.placement)}),[null==le?void 0:le.placement]),de=(0,n.useState)(C),ue=de[0],pe=de[1];n.useEffect((function(){return function(){oe.current&&window.clearTimeout(oe.current),oe.current=0}}),[ue]),H&&(w=void 0,C!==ue&&pe(C)),(0,m.t)($,(function(e){U&&pe(!1),D&&D(e)}),!!D||!!U);var me=(0,s.Z)(W,i),ve="click"===w?function(e){oe.current&&window.clearTimeout(oe.current),te.current=0,oe.current=0,pe(!ue),ae&&ae(),P.props.onClick&&P.props.onClick(e)}:P.props.onClick,xe="hover"===w?function(e){!ue&&window.performance.now()-te.current>500&&(oe.current=y?oe.current||window.setTimeout((function(){return pe(!0)}),y):(pe(!0),0),ae&&ae(),te.current=window.performance.now()),P.props.onMouseMove&&P.props.onMouseMove(e)}:P.props.onMouseMove,ge="hover"===w?function(e){return(0,o.__awaiter)(t,void 0,void 0,(function(){return(0,o.__generator)(this,(function(i){return R?setTimeout((function(){oe.current&&window.clearTimeout(oe.current),te.current=0,oe.current=0,pe(!1),ae&&ae(),P.props.onMouseLeave&&P.props.onMouseLeave(e)}),R):(oe.current&&window.clearTimeout(oe.current),te.current=0,oe.current=0,pe(!1),ae&&ae(),P.props.onMouseLeave&&P.props.onMouseLeave(e)),[2]}))}))}:P.props.onMouseLeave,he=(0,o.__assign)((0,o.__assign)({},P.props),{onClick:ve,onMouseMove:xe,onMouseLeave:ge,ref:me}),be=_?{appear:!0,mountOnEnter:!0,unmountOnExit:!0,onEnter:v}:{};return n.createElement(n.Fragment,null,n.cloneElement(P,he),n.createElement(d.ZP,(0,o.__assign)({in:ue,timeout:p.x9},be),(function(e){return f||Z?n.createElement(r.ZP,{container:f},n.createElement(u.Z,(0,o.__assign)({open:!0,arrow:g,arrowStyle:se.arrow,style:(0,o.__assign)((0,o.__assign)((0,o.__assign)({},se.popper),p.hy),ce[e]),bg:F,arrowRef:ie,ref:J},re.popper),n.createElement(a.Z,{ref:$},j))):n.createElement(u.Z,(0,o.__assign)({open:!0,arrow:g,arrowStyle:se.arrow,style:(0,o.__assign)((0,o.__assign)((0,o.__assign)({},se.popper),p.hy),ce[e]),bg:F,arrowRef:ie,ref:J},re.popper),n.createElement(a.Z,{ref:$},j))})))}))},1793:(e,i,t)=>{t.d(i,{Y:()=>o});var o=new function(){var e=this;this.cbs={},this.on=function(i,t){return e.cbs[i]||(e.cbs[i]=[]),e.cbs[i].push(t),function(){return e.off(i,t)}},this.off=function(i,t){e.cbs[i]||(e.cbs[i]=[]),e.cbs[i]=e.cbs[i].filter((function(e){return e!==t}))},this.emit=function(i){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];e.cbs[i]||(e.cbs[i]=[]),e.cbs[i].forEach((function(e){return"function"==typeof e&&e.apply(null,t)}))}}},55606:(e,i,t)=>{t.d(i,{C:()=>p});var o=t(39727),n=t(29261),s=t(75038),r=t(60190),a=t(58273),l=t(10370),c=t(31953),d=t(48752),u=t(45385);const p=({symbol:e,positionSide:i,orderPrice:t,assumePrice:p,triggerPrice:m,activationPrice:v,orderAmount:x,formType:g,side:h,cost:b,openLost:y,contractVal:f,reduceOnly:j=!1})=>{const k=(0,o.v9)(s.Y),O=(0,r.$J)(),P=(0,o.v9)(a._Y),C=(0,o.v9)(l.G),S=(0,n.AM)(),{marginAsset:w="BTC"}=(null==S?void 0:S[e])||{},T=(null==P?void 0:P[w])||{},M=(0,c._g)(e,i),K=O[M]||{},{entryPrice:N,positionSize:z,isolatedWallet:Z,bidNotional:I,askNotional:R}=K,L=Math.abs(z),A=Number(z),{takerCommission:V}=(0,n.aq)();if((1===h&&A<0||-1===h&&A>0)&&L&&(L===x||L<x&&j))return{liquidationPrice:0,currentPosition:K};const{estIsolatedWallet:q,estCrossWalletBalance:E}=(0,d.calculateEstWalletBalance)({entryPrice:N,positionSize:z,orderPrice:t,assumePrice:p,triggerPrice:m,activationPrice:v,orderAmount:x,formType:g,side:h,isolatedWallet:Z,crossWalletBalance:(null==T?void 0:T.crossWalletBalance)||0,cost:b,openLost:y,bidNotional:I,askNotional:R,contractVal:f,takerCommission:(V||0)/1e6}),_=Object.assign(Object.assign({},K),{entryPrice:(0,d.calculateEstEP)({entryPrice:N,positionSize:z,orderPrice:t,assumePrice:p,triggerPrice:m,activationPrice:v,orderAmount:x,formType:g,side:h}),positionSize:(0,d.calculateEstSize)({positionSize:z,orderAmount:x,side:h}),isolatedWallet:q}),D=Object.values(Object.assign(Object.assign({},O),{[M]:Object.assign({},_)})),U=(0,c.nn)({positions:(0,c.J9)(D),marginAsset:w}),F=(0,u.Ak)(k,[_],Object.assign(Object.assign({},P),{[w]:Object.assign(Object.assign({},P[w]),{crossWalletBalance:E})}),C,e,!0,!1,U),{liquidationPrice:H=0}=(null==F?void 0:F[0])||{};return{liquidationPrice:H,currentPosition:_}}},21688:(e,i,t)=>{t.r(i),t.d(i,{default:()=>yo});var o=t(52322),n=t(2784),s=t(39727),r=t(17620),a=t.n(r),l=t(81993),c=t(59651),d=t(5163),u=t(61750),p=t(36416),m=function(e){var i;void 0===e&&(e=!1),i=e?function(e){return Object.keys(e).length>1?(0,p.r7)((0,d.__assign)({},e)):(0,p.y)((0,d.__assign)({},e))}:function(e){return Object.keys(e).length>1?(0,p.Ce)((0,d.__assign)({},e)):(0,p.O9)((0,d.__assign)({},e))};var t=(0,u.Z)((function(e){return void 0===e&&(e={}),(0,d.__awaiter)(void 0,void 0,void 0,(function(){return(0,d.__generator)(this,(function(t){return[2,i(e)]}))}))}),[e]);return{loading:t[0].loading,delOpenOrders:t[1]}},v=t(92036),x=t(97060),g=t(77376),h=t(23131),b=t(38896),y=t(84423);function f(e){return(0,d.__awaiter)(this,void 0,void 0,(function(){var i;return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(0,y.U2)("/fapi/v1/ticker/bookTicker"+(e?"?symbol="+e:""))];case 1:return i=t.sent(),[3,3];case 2:return t.sent(),i=e?{}:[],[3,3];case 3:return[2,i]}}))}))}function j(e){return(0,d.__awaiter)(this,void 0,void 0,(function(){var i;return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(0,y.U2)("/dapi/v1/ticker/bookTicker"+(e?"?symbol="+e:""))];case 1:return i=t.sent(),i=e?(null==i?void 0:i[0])||{}:i,[3,3];case 2:return t.sent(),i=e?{}:[],[3,3];case 3:return[2,i]}}))}))}var k=t(18687);const O=(0,n.createContext)({actionAdjustMarginModal:e=>{},actionOrderConfirmModal:(e,i,t)=>{},actionTpslModal:e=>{},actionPlaceOrder:e=>{},actionCancelOrder:e=>{},changeSymbol:e=>{},isDelivery:!1,headers:[]});var P=t(19739);const C=n.memo((({visible:e,position:i,onClose:t})=>{const{sideKey:r,closeParams:a={},onConfirm:l}=i,{getI18n:c}=(0,x.yk)(),{orderConfirmation:d}=(0,b.F7)(),u=(0,s.I0)(),p=(0,b.t2)(r,"symbol"),m=(0,b.t2)(r,"positionSize"),v=(0,b.t2)(r,"entryPrice"),{orderType:g,limitPrice:h,qty:y,quantity:C}=a,S=(0,b.AM)()[p]||{},{isDelivery:w}=(0,n.useContext)(O),T=m>0?"SELL":"BUY",M="BUY"===T?"buy":"sell",K=c(m>0?"CloseLong":"CloseShort"),N="MARKET"===g,{contractVal:z}=S,[Z,I]=(0,n.useState)(0);(0,n.useEffect)((()=>{e&&(w?j:f)(p).then(((e={})=>{const{marketPNL:i,limitPNL:t}=(0,k.k)(Object.assign(Object.assign({},e),{quantity:C,isBuy:m>0,entryPrice:v,closedPrice:h,contractVal:z,isDelivery:w}));I(N?i:t)}))}),[z,v,w,N,h,m,C,p,e]);const R=(0,n.useCallback)((()=>{const e=Object.assign(Object.assign({},d),{[g.toUpperCase()]:!1});u.preference.changeOrderConfirmation(e)}),[u.preference,d,g]);return(0,o.jsx)(P.Z,{symbol:p,title:K,color:M,isMarket:N,limitPrice:h,qty:y,isClose:!0,epnl:Z,onClose:t,onConfirm:l,closeTip:R,orderSide:T},void 0)}));var S=t(21209),w=t(48658),T=t(45362),M=t(77711);const K="trd-Position",N=e=>(0,x.ZK)(K,e),z=e=>`${K}-${e}`;var Z=t(62143),I=t(37745),R=t(64296),L=t(66306),A=t(59546),V=t(26786);const q=({type:e,setType:i,maxAppend:t,maxRemovable:s,amount:r,setAmount:a,onConfirm:l,marginAsset:c})=>{const{getI18n:d}=N(),{getI18n:u}=(0,x.yk)(),p=(0,b.ce)(),m=(0,V.nH)(p),v="ADD"===e?u("maxAddable",{defaultValue:"Max addable"}):u("maxRemovable",{defaultValue:"Max removable"}),g="ADD"===e?t:s,h=`${d("amount",{defaultValue:"Amount"})}(${c})`,y=(0,o.jsxs)(Z.Z,Object.assign({as:"span"},{children:[v,(0,o.jsxs)(w.Z,Object.assign({as:"span",color:"t.primary"},{children:[" ",(0,V.GW)(g,p,!0)," ",c]}),void 0)]}),void 0),f=(0,V.GW)(g,p,!1),j=Number(r)>Number(f),k=(0,n.useMemo)((()=>[{value:"ADD",text:u("add",{defaultValue:"Add"})},{value:"REMOVE",text:u("remove",{defaultValue:"Remove"})}]),[u]),O=(0,o.jsxs)(Z.Z,Object.assign({sx:{position:"relative"}},{children:[(0,o.jsx)(Z.Z,{bg:"line",width:"1px",height:"24px",sx:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)"}},void 0),(0,o.jsx)(Z.Z,Object.assign({width:"120px"},{children:(0,o.jsx)(I.Z,Object.assign({hideSearch:!0,variant:"clear",size:"lg",value:e,renderValue:e=>{const i=k.find((i=>i.value===e));if(i)return(0,o.jsx)(w.Z,Object.assign({as:"span"},{children:i.text}),void 0)},onChange:e=>i(e)},{children:k.map(((e,i)=>(0,o.jsx)(R.W,Object.assign({value:e.value},{children:e.text}),i)))}),void 0)}),void 0)]}),void 0),P=(0,o.jsx)(T.Z,Object.assign({variant:"quiet",onClick:()=>a(f)},{children:d("Max",{defaultValue:"Max"})}),void 0);return(0,o.jsx)(L.Z,{variant:"filled",type:"number",label:h,extraInfo:y,prefix:O,suffix:P,step:m,value:r,error:j,onChange:e=>(0,A._p)(e,a,"",p),onKeyDown:e=>(0,A.f5)(e,l),onBlur:e=>(0,A.Y5)(e)},void 0)};var E=t(86828),_=t(33470),D=t(32027),U=t(87612),F=t(17584),H=t(56851),$=t(42902);const B=({label:e="",labelSuffix:i="",value:t="",unit:n="",labelClassName:s="",valueClassName:r="",className:a=""})=>(0,o.jsxs)("div",Object.assign({className:`field ${a}`},{children:[(0,o.jsxs)("div",Object.assign({className:`label ${s}`},{children:[e,i]}),void 0),(0,o.jsxs)("div",Object.assign({className:`value ${r}`},{children:[t," ",n]}),void 0)]}),void 0),Q=({children:e})=>(0,o.jsx)(Z.Z,Object.assign({sx:{width:"282px",fontSize:"12px",lineHeight:"16px"}},{children:e}),void 0),W=n.memo((({panelType:e,data:i})=>{const t=(0,b.tZ)(),{getI18n:n,t:s}=(0,x.yk)(),{symbol:r,isolatedWallet:a,maxAppend:l,maxRemovable:c,liquidationPrice:d,quoteAsset:u,marginAsset:p="USDT",pricePrecision:m}=i,v=(0,b.ce)(),g=(0,o.jsx)(E.Z,{sx:{color:"t.yellow"},href:`${h.Td}/${(0,$.sU)(t)}/articles/4404852569497`,target:"_blank"},void 0);return"ADD"===e?(()=>{const e=`${n("currentlyMarginFor",{defaultValue:"Currently Margin for"})} ${(0,F.lE)(r,n)}`,i=(0,_.uf)(a,v),t=n("maxAddable",{defaultValue:"Max addable"}),c=`${(0,V.GW)(l,v,!0)}`,x=(0,o.jsx)(H.m,Object.assign({tip:(0,o.jsx)(Q,{children:(0,o.jsx)(U.c,{t:s,i18nKey:"futures-trade-maxAddableTip",components:{jump:g},defaults:"Isolated position max addable amount is different from the available for order amount. More details are available on the <jump>Isolated transferrable margin calculations</jump>."},void 0)},void 0),hideUnderLine:!0,sx:{verticalAlign:"middle"},delay:1e3,placement:"top",arrow:!0},{children:(0,o.jsx)(D.Z,{ml:"4px",size:16},void 0)}),void 0),h=n("liqPriceAfterAdujst",{defaultValue:"Liq. Price after increase"}),b=d?(0,V.GW)(d,m,!0):"-";return(0,o.jsxs)(Z.Z,Object.assign({mt:"md"},{children:[(0,o.jsx)(B,{label:e,value:i,unit:p},void 0),(0,o.jsx)(B,{label:t,labelSuffix:x,value:c,unit:p},void 0),(0,o.jsx)(B,{label:h,value:b,unit:u},void 0)]}),void 0)})():(()=>{const e=n("assignedMargin",{defaultValue:"Currently Assigned Margin"}),i=(0,_.uf)(a,v),t=n("maxRemovable",{defaultValue:"Max removable"}),r=(0,V.GW)(c,v,!0),l=(0,o.jsx)(H.m,Object.assign({tip:(0,o.jsx)(Q,{children:(0,o.jsx)(U.c,{t:s,i18nKey:"futures-trade-maxRemovableTip",components:{jump:g},defaults:"Unrealized profit cannot be transferred from the isolated position. More details are available on <jump>Isolated transferrable margin calculations</jump>."},void 0)},void 0),hideUnderLine:!0,sx:{verticalAlign:"middle"},delay:1e3,placement:"top",arrow:!0},{children:(0,o.jsx)(D.Z,{ml:"4px",size:16},void 0)}),void 0),x=n("liqPriceAfterReduction",{defaultValue:"Liquidation Price after reduction"}),h=d?(0,V.GW)(d,m,!0):"-";return(0,o.jsxs)(Z.Z,Object.assign({mt:"md"},{children:[(0,o.jsx)(B,{label:e,value:i,unit:p},void 0),(0,o.jsx)(B,{label:t,labelSuffix:l,value:r,unit:p},void 0),(0,o.jsx)(B,{label:x,value:h,unit:u},void 0)]}),void 0)})()}));const G={position:"relative",padding:"0px 24px 24px 24px",width:["calc(100vw - 32px)","384px"],bg:"modalBg",boxShadow:"elevation3",borderRadius:"8px",".title":{fontSize:"20px",height:"64px",py:"20px",color:"t.primary"},".field":{display:"flex",justifyContent:"space-between",mt:"12px",letterSpacing:"0.16px",fontSize:"14px",lineHeight:"20px",fontWeight:"normal",minHeight:"20px",".label":{color:"t.third",flex:"auto"},".value":{color:"t.primary",textAlign:"right",flex:"none"}}},Y={ADD:1,REMOVE:2},J=n.memo((({visible:e,position:i,onClose:t})=>{var s;const{enqueueNotification:r}=(0,l.Z)(),{sideKey:a}=i,{getI18n:c}=N(),{getI18n:u}=(0,x.yk)(),[p,m]=(0,n.useState)("ADD"),[v,g]=(0,n.useState)(""),h="ADD"===p?Number(v):-Number(v),f=(0,b.t2)(a,"symbol"),j=(0,b.t2)(a,"positionSide"),k=(null===(s=(0,b.AM)())||void 0===s?void 0:s[f])||{},{marginAsset:O="",contractVal:P=100}=k,C=(0,n.useMemo)((()=>({symbol:f,marginAsset:O,positionSide:j})),[!1,f,O,P,j]);(0,n.useEffect)((()=>{a||g("")}),[a]);const K=(0,b.Bx)(Object.assign(Object.assign({},C),{delta:h})),z=()=>{return e=void 0,i=void 0,n=function*(){v&&function(e,i){return(0,d.__awaiter)(void 0,void 0,void 0,(function(){var t;return(0,d.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,(0,y.v_)("/bapi/futures/v1/private/future/user-data/adjust-position-margin",e,i)];case 1:return t=o.sent(),[3,3];case 2:return o.sent(),t={success:!1},[3,3];case 3:return[2,t]}}))}))}({type:Y[p],symbol:f,amount:v,positionSide:j},{}).then((e=>{const{success:i}=e;i&&r({message:u("changeMarginSuccess",{defaultValue:"Position margin adjustment failed"}),variant:"success"})})).catch((()=>{})).finally((()=>t()))},new((o=void 0)||(o=Promise))((function(t,s){function r(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var i;e.done?t(e.value):(i=e.value,i instanceof o?i:new o((function(e){e(i)}))).then(r,a)}l((n=n.apply(e,i||[])).next())}));var e,i,o,n};return(0,o.jsxs)(S.Z,Object.assign({visible:!!a&&e,sx:G,onMaskClick:()=>t()},{children:[(0,o.jsx)(w.Z,Object.assign({variant:"title6",className:"title"},{children:c("adjust-margin",{defaultValue:"Adjust Margin"})}),void 0),(0,o.jsx)(M.Z,{color:"t.third",sx:{position:"absolute",top:"20px",right:"24px",cursor:"pointer"},onClick:t},void 0),(0,o.jsx)(q,{type:p,setType:m,maxAppend:K.maxAppend,maxRemovable:K.maxRemovable,amount:v,setAmount:g,onConfirm:z,marginAsset:O},void 0),(0,o.jsx)(W,{panelType:p,data:K},void 0),(0,o.jsx)(T.Z,Object.assign({sz:"l",mt:"24px",width:1,onClick:z},{children:u("confirmBtn",{defaultValue:"Confirm"})}),void 0)]}),void 0)}));var X=t(45455),ee=t.n(X),ie=t(65776),te=t(1793),oe=t(41191),ne=t(54163);const se=n.memo((e=>{var{label:i,tip:t,value:n,hasTip:s=!0}=e,r=function(e,i){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&i.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)i.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(t[o[n]]=e[o[n]])}return t}(e,["label","tip","value","hasTip"]);return(0,o.jsxs)(v.Z,Object.assign({className:"rules"},r,{children:[s?(0,o.jsx)(H.m,Object.assign({tip:t},{children:i}),void 0):(0,o.jsx)(w.Z,Object.assign({className:"label"},{children:i}),void 0),n]}),void 0)})),re={position:"relative",px:"24px",width:["100%","488px"],height:["100%","unset"],bg:"modalBg",borderRadius:"6px",boxShadow:"elevation3",".title":{py:"20px",color:"t.primary"},".content":{pt:"14px",pb:"30px"},".rules":{alignItems:"center",justifyContent:"space-between",fontSize:1,pb:"ls",color:"t.primary"},".label":{color:"t.third"},".viewMore":{fontSize:1,px:"2px",py:"4px"}};let ae;n.memo((()=>{const e=(0,b.tZ)(),{getI18n:i}=(0,x.yk)(),t=(0,b.gm)(),s=(0,h.nM)(),{shortName:r}=(0,b.oO)(),{baseAsset:a,quoteAsset:l,filters:c=[],liquidationFee:d=0,contractVal:u=0,triggerProtect:p=0,maxMoveOrderLimit:m=0}=(0,b.j2)()||{},v=(0,oe.FB)(c,"filterType"),g=((e,i,t,o)=>{const n=[{labelKey:"minimumTradeAmount",defaultLabel:"Minimum Trade Amount",filterType:"LOT_SIZE",field:"minQty",tipKey:"minimumTradeAmountTip",defaultTip:"The minimum Limit Order amount for the contract.",unit:e},{labelKey:"minPriceMovement",defaultLabel:"Min Price Movement",filterType:"PRICE_FILTER",field:"tickSize",tipKey:"minPriceMovementTip",defaultTip:"The minimum change in the unit price of the contract.",unit:i},{labelKey:"orderPriceCapRatio",defaultLabel:"Order Price Cap Ratio",filterType:"PERCENT_PRICE",field:"multiplierUp",tipKey:"orderPriceCapRatioTip",defaultTip:"The upper limit ratio of the order price to current Mark Price of the contract.",unit:"%",shouldFormat:!0},{labelKey:"orderPriceFloorRatio",defaultLabel:"Order Price Floor Ratio",filterType:"PERCENT_PRICE",field:"multiplierDown",tipKey:"orderPriceFloorRatioTip",defaultTip:"The lower limit ratio of the order price to current Mark Price of the contract.",unit:"%",shouldFormat:!0},{labelKey:"maximumMarketOrderAmount",defaultLabel:"Maximum Market Order Amount",filterType:"MARKET_LOT_SIZE",field:"maxQty",tipKey:"maximumMarketOrderAmountTip",defaultTip:"The minimum Market Order amount for the contract.",unit:e},{labelKey:"maximumOpenOrderAmount",defaultLabel:"Maximum Open Order Amount",filterType:"MAX_NUM_ORDERS",field:"limit",tipKey:"maximumOpenOrderAmountTip",defaultTip:"The maxium Open Orders for the contract."}];return o||n.push({labelKey:"minNotional",defaultLabel:"Min. Notional Value",filterType:"MIN_NOTIONAL",field:"notional",tipKey:"minNotionalTip",defaultTip:"The minimum notional value for the contract order.",unit:i}),n})(s?i("Cont",{defaultValue:"Cont"}):a,l,0,s),[y,f]=(0,n.useState)(!1),j=(0,n.useCallback)((()=>{f(!1),"function"==typeof ae&&ae()}),[]);return(0,n.useEffect)((()=>te.Y.on(h.Dg,(({visible:e,afterClose:i})=>{f(e),ae=i}))),[]),(0,o.jsxs)(S.Z,Object.assign({visible:y,sx:re},{children:[(0,o.jsx)(w.Z,Object.assign({variant:"headline6",className:"title"},{children:i("trading-rules",{defaultValue:"Trading Rules"})}),void 0),(0,o.jsx)(M.Z,{sx:{position:"absolute",top:"22px",right:"24px",cursor:"pointer",color:"t.third","&:hover":{color:"t.primary"}},onClick:j},void 0),(0,o.jsxs)(Z.Z,Object.assign({className:"content"},{children:[(0,o.jsx)(se,{hasTip:!1,label:i("symbol",{defaultValue:"Symbol"}),value:r},void 0),g.map((({labelKey:e,defaultLabel:n,filterType:s,field:r,tipKey:a,defaultTip:l,unit:c="",shouldFormat:d=!1})=>{var u;let p=null===(u=null==v?void 0:v[s])||void 0===u?void 0:u[r];p="%"===c?100*("multiplierUp"===r?p-1:1-p):p;const m=d?(0,ne.uf)(p,0):p,x="rtl"===t?`${c} ${m}`:`${m} ${c}`;return(0,o.jsx)(se,{label:i(e,{defaultValue:n}),tip:i(a,{defaultValue:l}),value:x},e)})),s&&(0,o.jsx)(se,{label:i("contractSize",{defaultValue:"Contract Multiplier"}),tip:i("contractSizeTip"),value:`${u} ${l}`},void 0),(0,o.jsx)(se,{label:i("triggerProtect",{defaultValue:"Price Protection Rate"}),tip:i("triggerProtectTip"),value:100*+p+" %"},void 0),(0,o.jsx)(se,{label:i("liquidationFee",{defaultValue:"Insurance Clearance Fee"}),tip:i("liquidationFeeTip"),value:`${(100*+d).toFixed(2)} %`},void 0),s&&(0,o.jsx)(se,{label:i("maxAmendAmount",{defaultValue:"Max Amend Amount"}),tip:i("maxAmendAmountTip"),value:(0,ne.uf)(m,0)},void 0),(0,o.jsx)(T.Z,Object.assign({as:"a",variant:"text",href:`/${e}/futures/trading-rules/${s?"quarterly":"perpetual"}`,target:"_blank",className:"viewMore"},{children:i("viewMore",{defaultValue:"View More"})}),void 0)]}),void 0)]}),void 0)}));var le=t(72019);const ce=n.memo((({label:e,children:i})=>(0,o.jsxs)(v.Z,Object.assign({sx:{justifyContent:"space-between",fontSize:"14px",lineHeight:"16px",height:"24px",alignItems:"center"}},{children:[(0,o.jsx)(w.Z,Object.assign({color:"t.third"},{children:e}),void 0),(0,o.jsx)(v.Z,{children:i},void 0)]}),void 0))),de=n.memo((({sideKey:e})=>{const{getI18n:i}=N(),{symbolText:t,leverage:n}=(0,le.iA)({sideKey:e}),s=(0,b.t2)(e,"positionSize"),r=(0,b.t2)(e,"positionSide"),a=s>0?"buy":"sell";let l="";return"LONG"===r?l=i("psLong",{defaultValue:"Long"}):"SHORT"===r&&(l=i("psShort",{defaultValue:"Short"})),(0,o.jsx)(ce,Object.assign({label:i("symbol",{defaultValue:"Symbol"})},{children:(0,o.jsxs)(w.Z,Object.assign({color:a},{children:[t," ",l," ",n,"x"]}),void 0)}),void 0)})),ue=n.memo((({sideKey:e,quoteAsset:i})=>{const{getI18n:t}=N(),{formatedEntryPrice:n}=(0,le.A4)({sideKey:e});return(0,o.jsx)(ce,Object.assign({label:t("entryPrice",{defaultValue:"Entry Price"})},{children:(0,o.jsxs)(w.Z,Object.assign({sx:{color:"t.primary"}},{children:[n," ",i]}),void 0)}),void 0)})),pe=n.memo((({sideKey:e,quoteAsset:i})=>{const{getI18n:t}=N(),{formatedMarkPrice:n}=(0,le.z1)({sideKey:e});return(0,o.jsx)(ce,Object.assign({label:t("markPrice",{defaultValue:"Mark Price"})},{children:(0,o.jsxs)(w.Z,Object.assign({sx:{color:"t.primary"}},{children:[n," ",i]}),void 0)}),void 0)}));var me=t(53935),ve=t(3638),xe=t(39477);const ge=n.memo((({i18nType:e,stopIndex:i})=>{const{getI18n:t}=(0,x.yk)();return(0,o.jsxs)(v.Z,Object.assign({alignItems:"center",color:"t.third",pl:"8px"},{children:[e,"QUOTE"!==i&&(0,o.jsx)(H.m,Object.assign({tip:t("roe-stop-tip")},{children:(0,o.jsx)(me.Z,{size:16,ml:"4px"},void 0)}),void 0)]}),void 0)})),he=n.memo((({sideKey:e,order:i,type:t,cancelOrder:s,price:r,changePrice:a,workingType:l,changeWorkingType:c})=>{var d;const{getI18n:u}=N(),{getI18n:p}=(0,x.yk)(),m=(0,b.ce)(),g=(0,b.t2)(e,"symbol"),h=Number((0,b.t2)(e,"positionSize")),y=(0,b.NJ)(g),f=h>0?1:-1,j=(0,b.t2)(e,"entryPrice"),k=(null===(d=(0,b.AM)())||void 0===d?void 0:d[g])||{},{quoteAsset:P,marginAsset:C="",tickSize:S,pricePrecision:T,contractVal:M=100}=k,K=i?i.workingType:l,I=i?i.stopPrice:r,{isDelivery:R}=(0,n.useContext)(O),V=(0,ve.p)(S),q=S,E=(0,_.uf)(I,T),D=u("CONTRACT_PRICE"===K?"lastPrice":"markPrice"),F=(0,o.jsx)(U.c,{i18nKey:z("takeProfitNodeTip"),defaults:"When <text>{{workingType}}</text> reaches <text>{{stopPrice}}</text>, it will trigger Take Profit Market order to close this position. Estimated PNL will be",values:{workingType:D,stopPrice:E},components:{text:(0,o.jsx)(w.Z,{as:"span",color:"t.primary"},void 0)}},void 0),H=(0,o.jsx)(U.c,{i18nKey:z("stopLossNodeTip"),defaults:"When <text>{{workingType}}</text> reaches <text>{{stopPrice}}</text>, it will trigger Stop Market order to close this position. Estimated PNL will be",values:{workingType:D,stopPrice:E},components:{text:(0,o.jsx)(w.Z,{as:"span",color:"t.primary"},void 0)}},void 0),$=u("takeProfit"===t?"takeProfit":"stopLoss"),B="takeProfit"===t?F:H,Q=i&&(h>0&&"TAKE_PROFIT_MARKET"===i.type||h<0&&"STOP_MARKET"===i.type)?">=":"<=";let W="——",G="takeProfit"===t?"buy":"sell",Y="";if(""!==I){const e=(({stopPrice:e,entryPrice:i,positionSize:t,contractVal:o,isDelivery:n})=>n?t*o*(1/i-1/e):t*(e-i))({stopPrice:Number(I),entryPrice:j,positionSize:h,contractVal:M,isDelivery:R});Number.isFinite(e)&&(W=(0,_.uf)(e,m)),G=e>0?"buy":"sell",Y=e>0?"buy":e<0?"sell":""}const[J,X]=(0,n.useState)("QUOTE"),[ie,te]=(0,n.useState)(""),oe=((0,n.useCallback)((e=>{X(e),te(""),a("")}),[]),"QUOTE"===J?r:ie),ne=(0,n.useCallback)((e=>/[^\d|.|,|\u3002|e]/.test(e.key)&&e.preventDefault()),[]),se=(0,n.useCallback)((e=>{if("QUOTE"===J)(0,A._p)(e,a,"",V);else{const i=(0,_.GW)(Math.abs(e.target.value),2),o="takeProfit"===t?Number(i):-Number(i),n=(({roe:e,entryPrice:i,side:t,leverage:o,isDelivery:n})=>n?i*e/100/(t*o)+i:i*t*o/(t*o-e/100))({roe:o,entryPrice:j,side:f,leverage:y,isDelivery:R});te(o?String(o):""),a(n.toFixed(V))}}),[J,a,V,t,j,f,y,R]),re=(0,n.useCallback)((()=>!!i&&s(i,t)),[s,i,t]),ae="ROE"===J&&(({type:e,side:i,roe:t,leverage:o,isDelivery:n})=>!n&&"takeProfit"===e&&1===i&&t/100>=o||!n&&"takeProfit"!==e&&-1===i&&t/100<=-o||!!(n&&"takeProfit"===e&&-1===i&&t/100>=o)||!!(n&&"takeProfit"!==e&&1===i&&t/100<=-o))({type:t,side:f,roe:Number(ie),leverage:y,isDelivery:R}),le="takeProfit"===t?p("less-than-reo",{defaultValue:"The ROE% must be less than {{leveragedRoe}}%",leveragedRoe:100*y}):p("greater-than-reo",{defaultValue:"The ROE% must be greater than {{leveragedRoe}}%",leveragedRoe:-100*y});return(0,o.jsxs)(Z.Z,Object.assign({py:"16px"},{children:[ee()(i)?(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(L.Z,{type:"number",step:"QUOTE"===J?q:.01,variant:"filled",textAlign:"right",prefix:(0,o.jsx)(ge,{i18nType:$,stopIndex:J},void 0),placeholder:Number(0).toFixed(T),suffix:P,value:oe,error:ae,onKeyPress:ne,onChange:se,size:"md",boxProps:{sx:{flex:"auto",input:{pr:0}}}},void 0),(0,o.jsx)(xe.Z,{workingType:l,changeWorkingType:c},void 0)]},void 0):(0,o.jsx)(ce,Object.assign({label:$},{children:(0,o.jsxs)(v.Z,Object.assign({justifyContent:"end"},{children:[(0,o.jsx)(w.Z,Object.assign({color:"t.primary"},{children:`${D} ${Q} ${E} ${P}`}),void 0),(0,o.jsx)(w.Z,Object.assign({sx:{ml:"sm",cursor:"pointer",color:"t.yellow200","&:hover":{color:"t.yellow300"}},onClick:re},{children:u("cancel")}),void 0)]}),void 0)}),void 0),ae?(0,o.jsx)(Z.Z,Object.assign({sx:{mt:"xs",color:"sell",minHeight:"40px"}},{children:le}),void 0):(0,o.jsxs)(Z.Z,Object.assign({sx:{mt:"xs",width:"100%",fontSize:"12px",lineHeight:"20px",color:"t.third"}},{children:[B,(0,o.jsxs)(w.Z,Object.assign({as:"span",color:Y},{children:[" ",W," ",C]}),void 0)]}),void 0)]}),void 0)}));var be=t(17577),ye=function(e,i,t,o){return new(t||(t=Promise))((function(n,s){function r(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(r,a)}l((o=o.apply(e,i||[])).next())}))};const fe="MARK_PRICE",je={position:"relative",padding:"20px 24px 24px 24px",width:["100%","464px"],height:["100%","auto"],maxHeight:["100%","600px"],bg:"modalBg",boxShadow:"elevation3",borderRadius:"8px",".title":{fontSize:["16px","20px"],pb:"16px",color:"t.primary"},".info-block":{mt:"8px",".tpsl-max-qty-tip":{color:"t.primary",lineHeight:"20px",fontSize:"14px",".learn-more":{cursor:"pointer"}},".line":{height:"1px",bg:"line"}},".tpsl-tip":{color:"t.secondary",mt:"xs",fontSize:"12px"},".footer":{mt:"24px",display:"flex",position:["absolute","static"],bottom:["24px",null],width:["calc(100% - 48px)","100%"]}},ke=n.memo((({visible:e,position:i,onClose:t})=>{var s;const{sideKey:r=""}=i,a=(0,b.t2)(r,"symbol"),d=(0,b.t2)(r,"positionSize"),u=(0,b.t2)(r,"positionSide"),p=(0,b.AM)()[a]||{},{quoteAsset:v,filters:g}=p,y=null===(s=g.find(ie.vr))||void 0===s?void 0:s.maxQty,{strategyOrders:f}=(0,le.Mn)({sideKey:r}),[j,k]=(0,n.useState)(f.tp),[O,P]=(0,n.useState)(f.sl),[C,K]=(0,n.useState)(""),[z,Z]=(0,n.useState)(fe),[I,R]=(0,n.useState)(""),[L,A]=(0,n.useState)(fe);(0,n.useEffect)((()=>{e&&(k(f.tp),P(f.sl),K(""),Z(fe),R(""),A(fe))}),[e]);const{getI18n:V,i18n:{language:q}}=N(),{getI18n:E}=(0,x.yk)(),{enqueueNotification:_}=(0,l.Z)(),{delOpenOrders:D}=m(),U=(0,n.useCallback)(((e,i)=>ye(void 0,void 0,void 0,(function*(){const{success:t,data:o,message:n}=yield D(e);t&&(null==o?void 0:o.orderId)&&("takeProfit"===i&&k(void 0),"stopLoss"===i&&P(void 0)),t&&_({message:n||"success",variant:"success"})}))),[D,_]),F=(0,n.useCallback)(((e,i)=>ye(void 0,void 0,void 0,(function*(){const t={symbol:a,side:d>0?"SELL":"BUY",positionSide:u,type:i,timeInForce:"GTE_GTC",quantity:0,stopPrice:e.stopPrice,workingType:e.workingType,closePosition:!0,placeType:"position"},{success:o,message:n,data:s}=(Date.now(),yield(0,c.cG)((0,be.$)(t,{isLiteMode:!1}),{language:q}));o&&_({message:n||"success",variant:"success"})}))),[!1,a,q,d,u,_]),H=(0,n.useCallback)((()=>{(()=>{const e=ee()(j)&&C&&z,i=ee()(O)&&I&&L,o=[];e&&o.push(F({stopPrice:C,workingType:z},"TAKE_PROFIT_MARKET")),i&&o.push(F({stopPrice:I,workingType:L},"STOP_MARKET")),Promise.all(o).finally(t)})()}),[t,F,O,I,L,j,C,z]);return(0,o.jsxs)(S.Z,Object.assign({visible:!!r&&e,sx:je,onMaskClick:()=>t()},{children:[(0,o.jsx)(w.Z,Object.assign({variant:"headline6",className:"title"},{children:V("tpSl",{defaultValue:"TP/SL for entire position"})}),void 0),(0,o.jsx)(M.Z,{sx:{position:"absolute",top:"22px",right:"24px",cursor:"pointer",color:"t.third","&:hover":{color:"t.primary"}},onClick:t},void 0),(0,o.jsxs)("div",Object.assign({className:"info-block"},{children:[Math.abs(d)>Number(y)?(0,o.jsxs)("div",Object.assign({className:"tpsl-max-qty-tip"},{children:[E("tpslMaxQty-tip",{defaultValue:"Due to the position size exceeds the maximum limit of market order, the Position Take-profit and Stop-loss will not be executed. Please use Limit order or TP/SL limit order."}),(0,o.jsx)(w.Z,Object.assign({variant:"addressLink",color:"t.yellow",mt:"5px",className:"learn-more",onClick:()=>(({afterClose:e}={})=>{te.Y.emit(h.Dg,{visible:!0,afterClose:e})})()},{children:E("tpslMaxQty-learnMore",{defaultValue:"Learn more trading rules"})}),void 0)]}),void 0):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(de,{sideKey:r},void 0),(0,o.jsx)(ue,{sideKey:r,quoteAsset:v},void 0),(0,o.jsx)(pe,{sideKey:r,quoteAsset:v},void 0)]},void 0),(0,o.jsx)(he,{sideKey:r,order:j,cancelOrder:U,type:"takeProfit",price:C,changePrice:K,workingType:z,changeWorkingType:Z},void 0),(0,o.jsx)("div",{className:"line"},void 0),(0,o.jsx)(he,{sideKey:r,order:O,cancelOrder:U,type:"stopLoss",price:I,changePrice:R,workingType:L,changeWorkingType:A},void 0)]}),void 0),(0,o.jsxs)("div",Object.assign({className:"tpsl-tip"},{children:["· ",V("tpSlTip")]}),void 0),(0,o.jsx)("div",Object.assign({className:"footer"},{children:(0,o.jsx)(T.Z,Object.assign({flex:"auto",onClick:H,height:"40px"},{children:V("confirm",{defaultValue:"Confirm"})}),void 0)}),void 0)]}),void 0)}));var Oe=t(46502);var Pe=t(76940),Ce=t(44174),Se=t(73121);const we=({getFutI18n:e})=>{var i;const[t]=(0,b.z4)(),n=null===(i=(0,b.m8)()[t])||void 0===i?void 0:i.indexPrice,{formatTk:s}=(0,b.mC)();return(0,o.jsx)(o.Fragment,{children:e("markPriceTip",{defaultValue:"Latest mark price for this contract. To prevent price manipulation, the mark price is used for unrealized PNL and margin calculations, and may differ from the last price. \n Mark Price is calculated based on the index price. The Price Index is a bucket of prices from the major Spot market exchanges, weighted by their relative volume. The latest index price is {{indexPrice}}.",indexPrice:s(n)}).replaceAll("\\n","\n")},void 0)};var Te=t(89212),Me=t(51991);const Ke=(e,i)=>e.localeCompare(i),Ne=(0,Te.RRI)(Ke),ze=(e,i)=>+e-+i,Ze=(0,Te.RRI)(ze),Ie=["size","notionalSize","liquidationPrice","marginRatio","margin","pnl"],Re=(e,i)=>null==i?void 0:i[e];var Le=t(53096),Ae=t(33322),Ve=t(27986);const qe=n.memo((()=>{const{getI18n:e}=(0,x.yk)(),[i]=(0,b.z4)(),t=(0,s.I0)(),r=(0,b.Xb)(),a=(0,n.useRef)(r),l=(0,n.useCallback)((e=>{const{checked:o}=e.currentTarget;t.position.hideOtherSymbol({hideOtherSymbol:o,onlySymbol:i})}),[i,t.position]);return(0,n.useEffect)((()=>{a.current=r}),[r]),(0,n.useEffect)((()=>{a.current&&t.position.hideOtherSymbol({hideOtherSymbol:!0,onlySymbol:i})}),[i]),(0,o.jsxs)(Ae.Z,Object.assign({sx:{fontSize:[1,0],color:"t.third",cursor:["auto","auto","pointer"],lineHeight:["unset","24px","24px"]}},{children:[(0,o.jsx)(Ve.Z,{checked:r,onChange:l},void 0),(0,o.jsx)(w.Z,Object.assign({sx:{userSelect:"none"}},{children:e("hideOtherSymbol",{defaultValue:"Hide Other Symbol"})}),void 0)]}),void 0)}));var Ee=t(21030),_e=t(68598),De=t(5894),Ue=t(87364),Fe=t(5722),He=t(37227);const $e={pt:"xs",flexDirection:"column",alignItems:"center",textAlign:"center","& .title":{mt:"md",color:"t.primary"},"& .fail-info":{pt:"xs",mb:"md",width:"100%",maxHeight:304,overflowY:"auto","& .fail-order":{flexDirection:"column",mb:10},"& .symbol-wrap":{justifyContent:"center",alignItems:"center",mb:"2px","&.buy":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"buy"}},"&.sell":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"sell"}}},"& .symbolText":{display:"flex",alignItems:"center",mx:"minor"},"& .symbol":{mr:"minor"}}},Be=({variant:e,className:i,children:t,color:n,whiteSpace:s="pre-wrap"})=>(0,o.jsx)(w.Z,Object.assign({variant:e,className:i,color:n,sx:{whiteSpace:s}},{children:t}),void 0),Qe=n.memo((({orders:e,productMap:i,isCoinFutures:t})=>{const{getI18n:n}=N(),{getI18n:s}=(0,x.yk)();return(0,o.jsxs)(v.Z,Object.assign({sx:$e},{children:[(0,o.jsx)(Fe.Z,{size:80},void 0),(0,o.jsx)(w.Z,Object.assign({variant:"headline6",className:"title"},{children:s("ClosePositionsFailed")}),void 0),(0,o.jsx)("div",Object.assign({className:"fail-info"},{children:Object.values(e).map((({symbol:e,positionSide:r,amount:a,color:l,messages:c},d)=>{let u,p=e;const m=null==i?void 0:i[e],{baseAsset:x=""}=m||{},g=t?s("Cont",{defaultValue:"Cont"})||"Cont":x;return m&&(u=(0,He.H)(m,s)),(0,o.jsxs)(v.Z,Object.assign({className:"fail-order"},{children:[(0,o.jsxs)(v.Z,Object.assign({className:`symbol-wrap ${l}`},{children:[(0,o.jsx)("div",Object.assign({className:"symbolText"},{children:u?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Be,Object.assign({variant:"subtitle1",className:"symbol"},{children:u.symbol}),void 0),(0,o.jsxs)(Be,Object.assign({variant:"body1"},{children:[u.contractTypeI18n," ",u.deliveryDateFormat]}),void 0)]},void 0):(0,o.jsx)(Be,Object.assign({variant:"subtitle1"},{children:p}),void 0)}),void 0),(0,o.jsx)(Be,Object.assign({variant:"subtitle1",color:l},{children:"LONG"===r?n("psLong",{defaultValue:"Long"}):n("psShort",{defaultValue:"Short"})}),void 0)]}),void 0),c.map(((e="")=>(0,o.jsx)(w.Z,Object.assign({variant:"body2",color:"t.primary",mt:"3px"},{children:e.replace(/%unit%/,g)}),e)))]}),d)}))}),void 0),(0,o.jsx)(T.Z,Object.assign({sz:"large",width:"100%",onClick:()=>Ue.ZP.close()},{children:s("OK")}),void 0)]}),void 0)}));var We=t(31953);const Ge=({hideOtherSymbol:e=!1})=>{const i="light"===(0,b.Fg)(),t="traditional",s=(0,b.AM)(),[r]=(0,b.z4)(),{isDelivery:a}=(0,n.useContext)(O),{getI18n:l}=N(),{getI18n:c}=(0,x.ZK)("trd-openOrder"),d=(0,n.useMemo)((()=>e?{symbolList:[r],newOrderRespType:"RESULT"}:{newOrderRespType:"RESULT"}),[e,r]),u=(0,n.useCallback)((()=>{try{(0,De.FP)(d).then((e=>{const{success:n,data:{failedOrderRespList:r=[]}}=e||{};if(n&&r.length){const e=(0,We.QN)(r);Ue.ZP.show({isLight:i,color:t,sx:{minWidth:"360px",maxWidth:"360px"},onPressEnter:u,onPressEsc:()=>Ue.ZP.close(),children:(0,o.jsx)(Qe,{orders:e,productMap:s,isCoinFutures:a},void 0)})}Ue.ZP.close()}))}catch(e){Ue.ZP.close()}}),[d,i,s,a,t]),p=(0,n.useCallback)((()=>{Ue.ZP.close()}),[]);return(0,n.useCallback)((n=>{var s;null===(s=null==n?void 0:n.stopPropagation)||void 0===s||s.call(n),Ue.ZP.show({isLight:i,color:t,showCloseIcon:!1,sx:{width:["300px","360px"],height:"auto"},onPressEnter:()=>Ue.ZP.close(),onPressEsc:()=>Ue.ZP.close(),children:(0,o.jsxs)(Z.Z,{children:[(0,o.jsxs)(Z.Z,Object.assign({px:1,pt:[0,"16px"],sx:{textAlign:"center"}},{children:[(0,o.jsx)(_e.Z,{size:[60,96]},void 0),(0,o.jsx)("div",{children:e?l("closePositionTextPartial",{symbol:r,defaultValue:"Are you sure you want to close all positions of {{symbol}} at market price?"}):l("closePositionText",{defaultValue:"Are you sure you want to close all your positions at market price?"})},void 0)]}),void 0),(0,o.jsxs)(v.Z,Object.assign({mt:"24px"},{children:[(0,o.jsx)(T.Z,Object.assign({sx:{width:.5,mr:3},sz:"l",flexGrow:1,colorStyle:"secondary",onClick:p},{children:c("dialog-cancel",{defaultValue:"Cancel"})}),void 0),(0,o.jsx)(T.Z,Object.assign({sx:{width:.5},sz:"l",flexGrow:1,onClick:u},{children:c("dialog-confirm",{defaultValue:"Confirm"})}),void 0)]}),void 0)]},void 0)})}),[c,l,u,e,i,r,t,p])},Ye=({canPlaceOrder:e,closeTip:i})=>{const{getI18n:t,t:s}=(0,x.yk)(),r=Ge({hideOtherSymbol:!1}),a=(0,n.useMemo)((()=>({width:"231px",color:"#1E2329",".btn-area":{mt:"4px",display:"flex",justifyContent:"flex-end",alignItems:"center",".text":{fontSize:"14px",fontWeight:500,cursor:"pointer"},".white":{ml:"18px",backgroundImage:"none","&:hover":{backgroundImage:"none"}}}})),[]);return(0,o.jsxs)(Z.Z,Object.assign({sx:a},{children:[(0,o.jsxs)("div",Object.assign({className:"text"},{children:[t("service-abnormal",{defaultValue:"The service is currently overloaded or malfunctioning. "})," "," ",e&&(0,o.jsx)(U.c,{t:s,i18nKey:"futures-trade-abnormal-close-all",components:{bold:(0,o.jsx)("span",{style:{fontWeight:"bold"}},void 0)},defaults:"<bold>Cancel all open orders</bold> and <bold>close all positions</bold> here."},void 0)]}),void 0),e?(0,o.jsxs)("div",Object.assign({className:"btn-area"},{children:[(0,o.jsx)(w.Z,Object.assign({className:"text",onClick:i},{children:t("cancelBtnText",{defaultValue:"Cancel"})}),void 0),(0,o.jsx)(T.Z,Object.assign({className:"white",onClick:()=>{r(null),i()}},{children:t("confirmBtn",{defaultValue:"Confirm"})}),void 0)]}),void 0):(0,o.jsx)("div",Object.assign({className:"btn-area"},{children:(0,o.jsx)(T.Z,Object.assign({className:"white",onClick:i},{children:t("OK",{defaultValue:"OK"})}),void 0)}),void 0)]}),void 0)},Je=({btnText:e})=>{const i=(0,b.Xb)(),t=Ge({hideOtherSymbol:i});return(0,o.jsx)(T.Z,Object.assign({onClick:t,variant:"quiet",sz:"s",pl:"0"},{children:e}),void 0)},Xe=n.memo((({tip:e,title:i})=>{const{headers:t}=(0,n.useContext)(O),r=h.$f,[a,l]=(0,n.useState)(document.getElementById("position-pc"));(0,n.useEffect)((()=>{l(null)}),[t]),(0,n.useEffect)((()=>{l(document.getElementById("position-pc"))}),[r,a]);const c=(0,b.Dj)(),d=(null==c?void 0:c.length)||0,u=(0,b.zk)("abnormal"),p=(0,b.zk)("openTip"),m=(0,b.zk)("placeOrder"),v=(0,s.I0)(),x=(0,n.useCallback)((()=>v.serviceStatus.updateStateImmutable({openTip:!1})),[]),{activeTab:g}=(0,b.TH)();return"0"!==g?null:u?(0,o.jsx)("div",Object.assign({style:{width:"fit-content",position:"relative"}},{children:(0,o.jsx)(Ee.ZP,Object.assign({container:a,open:p,arrow:!0,boundary:document.body,bg:"primary",placement:"top-start",tip:(0,o.jsx)(Ye,{canPlaceOrder:m,closeTip:x},void 0)},{children:e?(0,o.jsx)(Je,{btnText:i},void 0):(0,o.jsx)(w.Z,Object.assign({sx:{fontSize:0,color:"t.secondary"}},{children:i}),void 0)}),void 0)}),void 0):e?(0,o.jsx)(H.m,Object.assign({tip:e},{children:d?(0,o.jsx)(Je,{btnText:i},void 0):i}),void 0):(0,o.jsx)(w.Z,Object.assign({sx:{fontSize:0,color:"t.secondary"}},{children:i}),void 0)})),ei=n.memo((()=>{const{getI18n:e}=N();return(0,o.jsxs)("div",Object.assign({className:"action-bar"},{children:[(0,o.jsx)(qe,{},void 0),(0,o.jsx)(Je,{btnText:e("closePosition")||""},void 0)]}),void 0)}));var ii=t(34553),ti=t(25181),oi=t(77536);const ni=e=>{const{getI18n:i}=N(),{qty:t,qtyError:n,defaultQty:s,qtyStep:r,handleAmountChange:a,onConfirm:l,baseAsset:c="BTC",positionSize:d}=e,u=Math.abs(d),p=(0,o.jsx)(v.Z,Object.assign({sx:{mr:"6px",color:"t.yellow200"}},{children:(0,o.jsx)(Z.Z,{children:c},void 0)}),void 0);return(0,o.jsx)(Z.Z,{children:(0,o.jsx)(L.Z,{variant:"outline",value:t,defaultValue:s,step:r,onChange:a,onKeyDown:e=>(0,A.f5)(e,l),onBlur:e=>(0,A.Y5)(e),error:n,placeholder:String(u),prefix:(0,o.jsx)(Z.Z,Object.assign({sx:{ml:2,color:"t.grey300"}},{children:i("Amount",{defaultValue:"Amount"})}),void 0),suffix:p,sx:{textAlign:"right"},boxProps:{width:"100%",mt:"8px",borderRadius:"2px"}},void 0)},void 0)},si=e=>{const{getI18n:i}=N(),{isMarket:t,price:n,priceError:s,handlePriceChange:r,initialMarkPrice:a,quoteAsset:l="USDT",priceStep:c}=e,d=t?"":a,u=i("price",{defaultValue:"Price"}),p=(0,o.jsxs)(v.Z,Object.assign({sx:{mr:1,width:t?"95px":"auto"}},{children:[t&&(0,o.jsx)(v.Z,Object.assign({flex:1},{children:i("Market",{defaultValue:"Market"})}),void 0),(0,o.jsx)(Z.Z,{children:l},void 0)]}),void 0);return(0,o.jsx)(Z.Z,{children:(0,o.jsx)(L.Z,{variant:"outline",labelFixed:!0,disabled:t,value:n,step:c,error:s,onChange:r,placeholder:d,defaultValue:a,prefix:(0,o.jsx)(Z.Z,Object.assign({sx:{ml:2,color:"t.grey300"}},{children:u}),void 0),suffix:p,sx:{textAlign:"right"},boxProps:{width:"100%",mt:"8px",borderRadius:"2px"}},void 0)},void 0)},ri=({onClick:e,sx:i,children:t})=>(0,o.jsx)(v.Z,Object.assign({justifyContent:"center",alignItems:"center",sx:Object.assign({display:"flex",flex:"1",minWidth:"40px",height:"24px",border:"1px solid",borderColor:"position.percentInputBorderColor",borderRadius:"2px",cursor:"pointer",mr:"4px",color:"t.third",bg:"bg3",textAlign:"center",":hover":{color:["t.yellow","t.yellow","t.primary"],bg:["bg3","bg3","line"],borderColor:"currentColor"},":last-of-type":{mr:0}},i),onClick:e},{children:t}),void 0),ai=({percents:e=[.1,.25,.5,.75,1],onChange:i=(e=>{}),sx:t={},percentSx:n={}})=>(0,o.jsx)(v.Z,Object.assign({variant:"dropdown",justifyContent:"space-between",sx:Object.assign({width:"100%",bg:"popupBg",borderRadius:"4px",p:"8px"},t)},{children:e.map((e=>(0,o.jsxs)(ri,Object.assign({sx:n,onClick:()=>i(e)},{children:[100*e,"%"]}),e)))}),void 0);var li=t(55742),ci=t(71787),di=t(75548),ui=t(74258),pi=t(9205),mi=t(90614),vi=t(48752),xi=t(42871);const gi={symbol:130,size:90,notionalSize:110,entryPrice:100,markPrice:100,liquidationPrice:90,marginRatio:110,margin:90,pnl:145,adl:75,closePosition:235,tpSl:130},hi=e=>({width:`${e}px`,flex:`1 0 ${e}px`}),bi={flexDirection:"column",height:"100%",flex:"1 0",overflowX:"auto",overflowY:"hidden",".action-bar":{display:"flex",alignItems:"center",justifyContent:"flex-end",position:"absolute",top:0,right:"16px",zIndex:"999",height:"40px","&.fullscreen":{right:"12px"}},".position-row":{my:0,py:0,display:"flex",alignItems:"center",flex:"none",color:"t.secondary",fontSize:[0],cursor:"auto",width:"100%",height:"40px",boxSizing:"border-box",borderBottom:"1px solid",borderBottomColor:"newLine","&.header":{height:"32px"},"& .header-item":{display:"flex",alignItems:"center","& .drag-icon":{display:"none",ml:"4px",color:"t.third",cursor:"move","&:hover":{color:"t.primary"}},"& .rank-icon":{display:"none",ml:"2px",transform:"scale(1.6)",pointerEvents:"none",flex:"none"},"&:hover .drag-icon, &:hover .rank-icon":{display:"inline"},"&.show-ranking .rank-icon":{display:"inline"}},"&.body":{":hover":{backgroundColor:"bg3",".symbol":{color:"t.yellow",".symbolRightArrow":{display:"block"}}},".symbol":{display:"flex",alignItems:"center",cursor:"pointer",".symbolRightArrow":{display:"none"},".bar":{width:4,height:"39px",mr:"4px","&-buy":{bg:"buy"},"&-sell":{bg:"sell"},"&-liq":{bg:"t.secondary"}},".leverage":{color:"t.yellow",bg:"tagBg",fontSize:"12px",ml:"4px",borderRadius:"2px",px:"minor"}},".size":{"&-buy":{color:"t.buy"},"&-sell":{color:"t.sell"},"&-liq":{color:"t.secondary"}},".liquidationPrice":{color:"t.emphasize",".liqRefresh":{cursor:"pointer"}},".marginRatio":{"&-negative ":{color:"negative"}},".margin":{display:"flex",alignItems:"center","&-text":{whiteSpace:"nowrap",mr:"4px"},"&-icon-container":{position:"relative",".red-point":{width:"6px",height:"6px",bg:"sell",borderRadius:"50%",top:"-3px",right:"-3px",position:"absolute"}}},".pnl":{display:"flex",alignItems:"center","&-buy ":{color:"t.buy"},"&-sell ":{color:"t.sell"}},".tpSl":{display:"flex",alignItems:"center","&-text":{mr:"4px"}}},".symbol":Object.assign({},hi(gi.symbol)),".size":Object.assign({},hi(gi.size)),".notionalSize":Object.assign({},hi(gi.notionalSize)),".entryPrice":Object.assign({},hi(gi.entryPrice)),".markPrice":Object.assign({},hi(gi.markPrice)),".liquidationPrice":Object.assign({},hi(gi.liquidationPrice)),".marginRatio":Object.assign({},hi(gi.marginRatio)),".margin":Object.assign({},hi(gi.margin)),".pnl":Object.assign({},hi(gi.pnl)),".adl":Object.assign({},hi(gi.adl)),".closePosition":Object.assign({},hi(gi.closePosition)),".tpSl":Object.assign({},hi(gi.tpSl))}},yi={minWidth:"228px",bg:"popupBg",borderRadius:"4px",px:"16px",py:"4px",maxHeight:"138px",overflow:"auto",boxShadow:"0px 0px 10px rgba(0,0,0,0.3)",".order":{color:"t.primary",fontSize:"12px",lineHeight:"16px",height:"32px",borderBottom:"solid 1px",borderColor:"line",justifyContent:"space-between",alignItems:"center","&:last-of-type":{border:"none"},".order-icon":{cursor:"pointer",color:"t.third","&:hover path":{fill:"t.primary"}}},".cancel":{color:"t.yellow200",cursor:"pointer",":hover":{color:"t.yellow300"}}},fi={height:"24px",mt:0,input:{p:"4px",fontSize:"12px"}};function ji({orders:e=[],symbol:i,handleCancel:t}){const s=(0,b.AM)(),{isDelivery:r}=(0,n.useContext)(O),a=s[i]||{},{marginAsset:l,pricePrecision:c,quantityPrecision:d,equalQtyPrecision:u,contractVal:p}=a,{getI18n:m}=(0,pi.yk)(),{getI18n:x}=(0,pi.ZK)("trd-openOrder",undefined);const{isCoinUnit:g}=(0,mi.QV)(),{getFormatedQuantity:h}=(0,xi.s7)(a);return e.length?(0,o.jsx)(Z.Z,Object.assign({sx:yi},{children:e.map((e=>(0,o.jsxs)(v.Z,Object.assign({className:"order"},{children:[(0,o.jsxs)(w.Z,Object.assign({sx:{mr:"43px",color:"position.limitOrdersColor"}},{children:[r?g?(0,vi.unitChangeCoinQty)({quantity:e.origQty,contractVal:p,price:e.price,precision:u}):(0,_.uf)(e.origQty,d):h({quantity:e.origQty,price:e.price,qtyPrecision:d})," ",r?g?l:m("Cont",{defaultValue:"Cont"}):""," ",m("toBeClosedAt",{defaultValue:"to be closed at"})," ",(0,_.uf)(e.price,c)]}),void 0),(0,o.jsx)(ui.Z,{className:"order-icon",size:20,onClick:()=>{t(e.orderId)}},void 0)]}),e.orderId)))}),void 0):null}var ki=t(13644);const Oi=({sideKey:e,qty:i,isDelivery:t,isCoinUnit:o,isUsdtFuturesUSDTUnit:n,positionSize:s,stepSizePrecision:r,tickSizePrecision:a,equalQtyPrecision:l})=>{const{quantityAmount:c}=(0,le.v_)({sideKey:e}),d=Math.abs(Number(c.replace("-",""))),u=Number(i)/Math.abs(s)*d;let p=r;return t&&o?p=l:!t&&n&&(p=a),(0,_.yd)(u,p,1)},Pi=e=>{var i,t;const{getI18n:o}=N(),{getI18n:s}=(0,x.yk)(),{enqueueNotification:r}=(0,l.Z)(),{orderConfirmation:a}=(0,b.F7)(),{isCoinUnit:c}=(0,mi.QV)(),{isUSDTUnit:d}=(0,ki.Q)(),{actionPlaceOrder:u,actionOrderConfirmModal:p,isDelivery:m}=(0,n.useContext)(O),v=(0,n.useRef)(null),g=(0,b.t2)(e,"symbol"),h=(0,b.t2)(e,"positionSize"),y=(0,b.t2)(e,"positionSide"),f=(0,b.t2)(e,"initialMarkPrice"),j=(0,b.t2)(e,"selectPrice"),k=(0,b.AM)()[g]||{},{filters:P=[],baseAsset:C,tickSize:S=.01,limitStepSize:w=.001,equalQtyPrecision:T}=k,M=P&&(null===(i=P.find(ie.W4))||void 0===i?void 0:i.maxQty),K=P&&(null===(t=P.find(ie.vr))||void 0===t?void 0:t.maxQty),z=(0,ve.p)(S),[Z,I]=(0,n.useState)(Number(f).toFixed(z)),R=0===Number(Z),L=(0,ve.p)(w),[q,E]=(0,n.useState)(!1),D=m?0:L,U=(0,_.yd)(Math.abs(h),D,1),[F,H]=(0,n.useState)(U),$=Number(F)>Math.abs(h),B=m?s("Cont"):C,Q=S,W=(0,V.nH)(D);(0,n.useEffect)((()=>{j&&I(String(j))}),[j]),(0,n.useEffect)((()=>{q||H(U)}),[q,U]);const G=(0,di.D)((({orderType:i})=>{var t;const o=Number(F);if(!(null==v?void 0:v.current)||!o)return;const n=()=>{u({symbol:g,type:i,side:h>0?"SELL":"BUY",quantity:o,price:Z,positionSide:y})},s={orderType:i,limitPrice:Z,qty:Number(null===(t=null==v?void 0:v.current)||void 0===t?void 0:t.preferredUnitQty),quantity:o};a[i]?p(e,s,n):n()})),Y=(0,di.D)((()=>{if(K&&Number(F)>Number(K))return r({header:o("maxPromptTitle",{defaultValue:"Quantity Failed"}),message:`${o("maxMarketQty",{defaultValue:"Maximum Market Order Quantity"})}: ${K} ${B}`,autoHideDuration:1e4}),"";G({orderType:"MARKET"})})),J=(0,di.D)((()=>R?"":M&&Number(F)>Number(M)?(r({header:o("maxPromptTitle",{defaultValue:"Quantity Failed"}),message:`${o("maxLimitQty",{defaultValue:"Maximum Limit Order Quantity"})}: ${M} ${B}`,autoHideDuration:1e4}),""):void G({orderType:"LIMIT"})));return{symbol:g,initialMarkPrice:f,defaultQty:U,qty:F,qtyError:$,qtyStep:W,priceError:R,price:Z,priceStep:Q,nullRef:v,handlePriceChange:e=>(0,A._p)(e,(e=>I(e)),null,z),handleAmountChange:e=>{(0,A._p)(e,(e=>H(e)),null,D),E(!0)},handlePercentageClick:e=>{H((0,_.yd)(e*Math.abs(h),D,1)),E(!0)},onMarketClick:Y,onLimitClick:J,quantityObj:{sideKey:e,isDelivery:m,isCoinUnit:c,isUsdtFuturesUSDTUnit:d,qty:F,positionSize:h,stepSizePrecision:L,tickSizePrecision:z,equalQtyPrecision:T}}},Ci=(0,n.forwardRef)((({sideKey:e,isDelivery:i,isCoinUnit:t,isUsdtFuturesUSDTUnit:o,qty:s,positionSize:r,stepSizePrecision:a,tickSizePrecision:l,equalQtyPrecision:c},d)=>{const u=Oi({sideKey:e,qty:s,isDelivery:i,isCoinUnit:t,isUsdtFuturesUSDTUnit:o,positionSize:r,stepSizePrecision:a,tickSizePrecision:l,equalQtyPrecision:c});return(0,n.useImperativeHandle)(d,(()=>({preferredUnitQty:u}))),null})),Si=({qty:e,symbol:i,positionSize:t,isUsdtFuturesUSDTUnit:n,isCoinUnit:s,isDelivery:r,sideKey:a,stepSizePrecision:l,tickSizePrecision:c,equalQtyPrecision:d})=>{const{getI18n:u,t:p}=(0,x.yk)(),m=Math.abs(t),v=(0,b.AM)()[i]||{},{baseAsset:g,quoteAsset:h}=v,y=r?u("Cont",{defaultValue:"Cont"}):g,f=r?g:h,j=e,k=Oi({sideKey:a,qty:e,isDelivery:r,isCoinUnit:s,isUsdtFuturesUSDTUnit:n,positionSize:t,stepSizePrecision:l,tickSizePrecision:c,equalQtyPrecision:d});return r&&s||!r&&n?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:p("closePosition-qtyTip-positionSize",{defaultValue:"Position Size: {{positionSize}} {{orderUnit}}",positionSize:m,orderUnit:y})},void 0),(0,o.jsx)("div",{children:p("closePosition-qtyTip-unitConversion",{defaultValue:"Qty: {{orderQty}} {{orderUnit}} ≈ {{preferredUnitQty}} {{preferredUnit}}",orderQty:j,orderUnit:y,preferredUnitQty:k,preferredUnit:f})},void 0)]},void 0):(0,o.jsx)(o.Fragment,{children:p("closePosition-qtyTip-unit",{defaultValue:"Qty: {{orderUnit}}",orderUnit:y})},void 0)},wi=n.memo((({sideKey:e})=>{const{getI18n:i}=N(),{getI18n:t}=(0,x.yk)(),{symbol:s,initialMarkPrice:r,defaultQty:a,qty:l,qtyError:c,qtyStep:d,priceError:u,price:p,priceStep:m,nullRef:g,quantityObj:h,handlePriceChange:y,handleAmountChange:f,handlePercentageClick:j,onMarketClick:k,onLimitClick:P}=Pi(e),{handleCancel:C,placedOrdersLength:S,placedOrders:w}=(e=>{const i=(0,b.t2)(e,"symbol"),t=(0,b.t2)(e,"positionSize"),o=(0,b.t2)(e,"positionSide"),{preOrders:s}=(0,b.E)(),r=s.filter((e=>e.reduceOnly&&"LIMIT"===e.type&&e.symbol===i&&e.positionSide===o&&e.side===(t>0?"SELL":"BUY"))),a=r.length,{actionCancelOrder:l}=(0,n.useContext)(O);return{handleCancel:e=>{e&&l(e)},placedOrdersLength:a,placedOrders:r}})(e);return(0,o.jsxs)(v.Z,Object.assign({alignItems:"center",width:"100%",sx:{flexGrow:2}},{children:[(0,o.jsx)(T.Z,Object.assign({variant:"text",sx:{pl:0,pr:"8px",fontSize:"12px"},onClick:k},{children:i("market",{defaultValue:"Market"})}),void 0),(0,o.jsx)(li.ZP,Object.assign({trigger:"hover",enablePortal:!0,placement:"top",sx:{minWidth:"auto"},overlay:(0,o.jsx)(ji,{orders:w,symbol:s,handleCancel:C},void 0)},{children:(0,o.jsx)(T.Z,Object.assign({variant:"text",sx:{px:"8px",fontSize:"12px",borderRadius:"0",borderLeft:"1px solid",borderLeftColor:"newLine"},onClick:P},{children:`${i("limit",{defaultValue:"Limit"})}${S>0?`(${S})`:""}`}),void 0)}),void 0),(0,o.jsx)(ci.Z,Object.assign({enablePortal:!0,placement:"top",arrow:!0,tip:(0,o.jsx)("div",{children:u?t("invalid-price",{defaultValue:"Invalid Price"}):i("price",{defaultValue:"Price"})},void 0)},{children:(0,o.jsx)(L.Z,{variant:"filled",boxProps:{sx:fi},type:"number",value:p,step:m,error:u,onChange:y,defaultValue:r},void 0)}),void 0),(0,o.jsx)(li.ZP,Object.assign({trigger:"click",enablePortal:!0,placement:"bottom-end",sx:{mx:"4px"},overlay:(0,o.jsx)(ai,{sx:{width:"230px"},onChange:j},void 0)},{children:(0,o.jsx)(ci.Z,Object.assign({enablePortal:!0,placement:"top",arrow:!0,tip:(0,o.jsx)(Si,Object.assign({},h,{symbol:s}),void 0)},{children:(0,o.jsx)(L.Z,{variant:"filled",boxProps:{sx:fi},value:l,error:c,onChange:f,defaultValue:a,step:d},void 0)}),void 0)}),void 0),(0,o.jsx)(Ci,Object.assign({ref:g},h),void 0)]}),void 0)})),Ti=n.memo((({sideKey:e,panelType:i,onClose:t})=>{var s;const{symbol:r,initialMarkPrice:a,defaultQty:l,qtyError:c,qty:d,qtyStep:u,priceError:p,price:m,priceStep:v,nullRef:g,quantityObj:h,handlePriceChange:y,handleAmountChange:P,handlePercentageClick:C,onMarketClick:S,onLimitClick:w}=Pi(e),{getI18n:M}=N(),{getI18n:K}=(0,x.yk)(),{isDelivery:z}=(0,n.useContext)(O),I=(0,b.t2)(e,"positionSize"),R=(0,b.t2)(e,"entryPrice"),L=(null===(s=(0,b.AM)())||void 0===s?void 0:s[r])||{},{baseAsset:A,quoteAsset:V,contractVal:q}=L,E="MARKET"===i,{marketPNL:_,limitPNL:D}=function({symbol:e,quantity:i,isBuy:t,entryPrice:o=0,closedPrice:s=0,contractVal:r=100,isDelivery:a}){const l=function({symbol:e,isDelivery:i}){const{value:t=(e?{}:[])}=(0,Oe.N)((()=>i?j(e):f(e)),[e,i]);return t}({symbol:e,isDelivery:a}),{askPrice:c=0,bidPrice:d=0}=l;return(0,n.useMemo)((()=>(0,k.k)({quantity:i,isBuy:t,entryPrice:o,closedPrice:s,contractVal:r,isDelivery:a,askPrice:c,bidPrice:d})),[c,d,s,r,o,t,a,i])}({symbol:r,quantity:Number(d),isBuy:I>0,entryPrice:R,closedPrice:m||a,contractVal:q,isDelivery:z}),U=E?_:D,F=()=>{t(),E?S():w()};return(0,o.jsxs)(Z.Z,Object.assign({mt:"md"},{children:[(0,o.jsx)(Ci,Object.assign({ref:g},h),void 0),(0,o.jsx)(si,{isMarket:E,price:m,priceError:p,priceStep:v,handlePriceChange:y,initialMarkPrice:a,quoteAsset:V},void 0),(0,o.jsx)(ni,{qty:d,qtyError:c,defaultQty:l,qtyStep:u,positionSize:I,baseAsset:z?K("Cont",{defaultValue:"Cont"}):A,handleAmountChange:P,onConfirm:F},void 0),(0,o.jsx)(ai,{sx:{bg:"transparent",px:0},percentSx:{height:"32px",mr:"8px"},onChange:C},void 0),(0,o.jsxs)(Z.Z,Object.assign({sx:{mt:"plus",mb:"24px",lineHeight:"34px"}},{children:[(0,o.jsxs)(Z.Z,Object.assign({color:"t.third",as:"span"},{children:[M("estimatedPNL",{defaultValue:"Estimated PNL"}),":"]}),void 0),(0,o.jsxs)(Z.Z,Object.assign({sx:{float:"right"}},{children:[isNaN(Number(U))?"-":(0,ne.uf)(U,z?4:2)," ",V]}),void 0)]}),void 0),(0,o.jsx)(T.Z,Object.assign({disabled:!1,sz:"l",width:1,onClick:F},{children:M("confirm",{defaultValue:"Confirm"})}),void 0)]}),void 0)})),Mi=({active:e,title:i})=>{const t=(0,o.jsx)(Z.Z,{sx:{width:"100%",height:"2px",bg:"primary",position:"absolute",bottom:"-1px"}},void 0);return(0,o.jsxs)(Z.Z,Object.assign({sx:{position:"relative",mr:"16px",pt:"2px",pb:"14px",fontSize:"16px",fontWeight:"medium"},color:e?"t.primary":"t.grey300"},{children:[i," ",e?t:null]}),void 0)},Ki=n.memo((({open:e,curSideKey:i,onClose:t})=>{const[s,r]=(0,n.useState)("MARKET"),{getI18n:a}=N(),l=(0,n.useCallback)((e=>{r(e)}),[r]);return(0,o.jsx)(ii.Z,Object.assign({open:e,onCloseIconClick:t,containerSx:{alignItems:"flex-end"},sx:{width:["100%","464px"],height:"auto",position:["relative","absolute"],top:["auto","50%"],transform:["none","translateY(-50%)"]},closeSx:{zIndex:1}},{children:(0,o.jsxs)(ti.Z,Object.assign({lazy:!0,defaultActiveKey:s,onChange:l,tabsSx:{borderBottom:"1px solid",borderBottomColor:"lines.primary",overflow:"visible"}},{children:[(0,o.jsx)(oi.Z,Object.assign({tab:e=>(0,o.jsx)(Mi,{active:e,title:a("MarketClose",{defaultValue:"Market Close"})},void 0),tabKey:"MARKET"},{children:(0,o.jsx)(Ti,{panelType:"MARKET",sideKey:i,onClose:t},void 0)}),void 0),(0,o.jsx)(oi.Z,Object.assign({tab:e=>(0,o.jsx)(Mi,{active:e,title:a("LimitClose",{defaultValue:"Limit Close"})},void 0),tabKey:"LIMIT"},{children:(0,o.jsx)(Ti,{panelType:"LIMIT",sideKey:i,onClose:t},void 0)}),void 0)]}),void 0)}),void 0)}));var Ni=t(8826),zi=t(98569);const Zi=function(e){return n.createElement(zi.Z,(0,d.__assign)({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none"},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.314 4.781l3.889 3.89-1.768 1.767-3.889-3.889 1.768-1.768zm-3.182 3.182l3.89 3.89-5.129 5.127H15v3H7.893l-.004.004H4v-3.889l8.132-8.132zM17 16.98h3v3h-3v-3z",fill:"currentColor"}))};var Ii=t(56271),Ri=t(18228);const Li=Ri.BA[400],Ai=({filled:e})=>{const i=e?Li:"transparent";return(0,o.jsx)(Z.Z,{__css:{display:"inline-block",width:"4px",height:"14px",mx:"1px",border:`1px solid ${Li}`,bg:i}},void 0)},Vi=e=>{var{adl:i=0,dashed:t=!1}=e,n=function(e,i){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&i.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)i.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(t[o[n]]=e[o[n]])}return t}(e,["adl","dashed"]);return(0,o.jsxs)(Z.Z,Object.assign({},n,{sx:{borderBottom:t?`1px dashed ${Li}`:"none"}},{children:[Array(i).fill(0).map(((e,i)=>(0,o.jsx)(Ai,{filled:!0},i))),Array(4-i).fill(0).map(((e,i)=>(0,o.jsx)(Ai,{filled:!1},i)))]}),void 0)};var qi=t(75038);const Ei=()=>{const[e,i]=(0,n.useState)(!1),t=(0,s.I0)(),o=(0,h.nM)(),{isError:r}=(0,s.v9)(qi.Y),a=(0,b.Kc)("isError"),l=r||a,c=(0,n.useCallback)((()=>{return n=void 0,s=void 0,a=function*(){if(!e){i(!0);try{yield t.balance.getBalance(o),yield t.bracket.getBrackets()}catch(e){i(!1)}i(!1)}},new((r=void 0)||(r=Promise))((function(e,i){function t(e){try{l(a.next(e))}catch(e){i(e)}}function o(e){try{l(a.throw(e))}catch(e){i(e)}}function l(i){var n;i.done?e(i.value):(n=i.value,n instanceof r?n:new r((function(e){e(n)}))).then(t,o)}l((a=a.apply(n,s||[])).next())}));var n,s,r,a}),[t.balance,t.bracket,o,e]);return(0,n.useMemo)((()=>({showLiqRefresh:l,handleLiqRefresh:c})),[c,l])};var _i=t(71994);const Di=["size","notionalSize","entryPrice","markPrice","liquidationPrice","marginRatio","margin","pnl","tpsl"],Ui=({children:e})=>(0,o.jsx)(w.Z,Object.assign({variant:"caption",color:"t.third"},{children:e}),void 0),Fi=({color:e,children:i})=>(0,o.jsx)(w.Z,Object.assign({variant:"captionSub",color:e||"t.primary"},{children:i}),void 0),Hi=({children:e,sx:i})=>(0,o.jsx)(v.Z,Object.assign({className:"row-item",sx:i},{children:e}),void 0),$i=({sideKey:e,actionPlaceOrderModal:i})=>{const{getI18n:t}=N(),{color:s,symbolText:r,symbolName:a,leverage:l}=(0,le.iA)({sideKey:e}),c=(0,b.t2)(e,"positionSize"),d=(0,b.t2)(e,"adl"),u=(0,n.useCallback)((()=>{i(e)}),[i,e]);return(0,o.jsxs)(Hi,Object.assign({sx:{pb:"10px !important"}},{children:[(0,o.jsxs)("div",Object.assign({className:`symbol-wrap ${s}`},{children:[a?(0,o.jsxs)("div",Object.assign({className:"symbolText"},{children:[(0,o.jsx)("div",Object.assign({className:"symbol"},{children:a.symbol}),void 0),(0,o.jsx)("div",{children:`${a.contractTypeI18n} ${a.deliveryDateFormat}`},void 0)]}),void 0):(0,o.jsx)("div",Object.assign({className:"symbolText"},{children:r}),void 0),(0,o.jsx)("div",Object.assign({className:"leverage"},{children:`${l}x`}),void 0),(0,o.jsx)(Vi,{adl:d},void 0),(0,o.jsx)(Ii.Z,{sideKey:e},void 0)]}),void 0),0===Number(c)?null:(0,o.jsx)(w.Z,Object.assign({className:"close-position",onClick:u},{children:t("closePositionSingle",{defaultValue:"Close Position"})}),void 0)]}),void 0)},Bi=({sideKey:e})=>{const{getI18n:i}=N(),{color:t,formatedQuantityAmount:n,unit:s}=(0,le.v_)({sideKey:e});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.m,Object.assign({tip:i("uSizeDes",{defaultValue:"Trading units using stable coins in USDⓈ-M Futures such as USDT, open position amounts shown are calculated based on the actual coin quantity. Values change with the last price of the symbol."})},{children:i("size",{defaultValue:"Size"})}),void 0),(0,o.jsxs)(Fi,Object.assign({color:t},{children:[n," ",s]}),void 0)]},void 0)},Qi=({sideKey:e})=>{const{getI18n:i}=(0,x.yk)(),{formattedNotionalSize:t,unit:n}=(0,le.jK)({sideKey:e});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ui,{children:i("notionalSize",{defaultValue:"Notional Size"})},void 0),(0,o.jsxs)(Fi,{children:[t," ",n]},void 0)]},void 0)},Wi=({sideKey:e})=>{const{getI18n:i}=N(),{useLastPrice:t}=(0,b.F7)(),n=t?"lastPrice":"markPrice",{formatedPnl:s,pnlColor:r,ROEVal:a}=(0,le.qU)({sideKey:e});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.m,Object.assign({tip:i(`unrealizedPnlTip-${n}`)},{children:i("m-unrealizedPnl",{defaultValue:"Unrealized PNL(ROE %)"})}),void 0),(0,o.jsx)(Fi,Object.assign({color:r},{children:`${s}(${a})`}),void 0)]},void 0)},Gi=({sideKey:e})=>{const{getI18n:i}=N(),{formatedEntryPrice:t}=(0,le.A4)({sideKey:e});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.m,Object.assign({tip:i("entryPriceTip",{defaultValue:"Average executed buy/sell price for your current long/short position."})},{children:i("entryPrice",{defaultValue:"Entry Price"})}),void 0),(0,o.jsx)(Fi,{children:t},void 0)]},void 0)},Yi=({sideKey:e})=>{const{getI18n:i,i18n:{language:t}}=N(),{formatedMarkPrice:n}=(0,le.z1)({sideKey:e});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.m,Object.assign({tip:i("markPriceTip",{defaultValue:"The latest mark price for this contract. This is the price used for PNL and margin calculations, and may differ from the last price for the purposes of avoiding price manipulation."}),learnMoreLink:(0,Ni.C)(h.Wh.UM_MARK_PRICE,{locale:(0,$.sU)(t)})},{children:i("markPrice",{defaultValue:"Mark Price"})}),void 0),(0,o.jsx)(Fi,{children:n},void 0)]},void 0)},Ji=({liquidationPrice:e,formatedLiqPrice:i})=>{const{showLiqRefresh:t,handleLiqRefresh:n}=Ei(),{getI18n:s,i18n:{language:r}}=N(),{getI18n:a}=(0,x.yk)();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.m,Object.assign({tip:s("liquidationPriceTip",{defaultValue:"If the mark price of the contract reaches below this price (when long) or above this price(when short), your position will be liquidated."}),learnMoreLink:(0,Ni.C)(h.Wh.LIQ_PRICE,{locale:(0,$.sU)(r)})},{children:s("m-liquidationPrice",{defaultValue:"Liquidation Price"})}),void 0),(0,o.jsx)(Fi,Object.assign({color:"t.emphasize"},{children:t?(0,o.jsx)("div",Object.assign({onClick:n},{children:a("refresh",{defaultValue:"Refresh"})}),void 0):e>0?i:"-"}),void 0)]},void 0)},Xi=({sideKey:e})=>{const{liquidationPrice:i,formatedLiqPrice:t}=(0,le.Mx)({sideKey:e});return(0,o.jsx)(Ji,{liquidationPrice:i,formatedLiqPrice:t},void 0)},et=({sideKey:e})=>{const{liquidationPrice:i,formatedLiqPrice:t}=(0,_i.e)({sideKey:e});return(0,o.jsx)(Ji,{liquidationPrice:i,formatedLiqPrice:t},void 0)},it=({ratioColor:e,riskRatio:i})=>{const{getI18n:t}=N();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.m,Object.assign({tip:t("marginRatioTip",{defaultValue:"The lower the Margin Ratio, the lower your liquidation level will be relative to your position size. Your positions will be liquidated once Margin Ratio reaches 100%."})},{children:t("marginRatio",{defaultValue:"Margin Ratio"})}),void 0),(0,o.jsxs)(Fi,Object.assign({color:e},{children:[i,"%"]}),void 0)]},void 0)},tt=({sideKey:e})=>{const{ratioColor:i,riskRatio:t}=(0,le.ek)({sideKey:e});return(0,o.jsx)(it,{ratioColor:i,riskRatio:t},void 0)},ot=({sideKey:e})=>{const{ratioColor:i,riskRatio:t}=(0,_i.U)({sideKey:e});return(0,o.jsx)(it,{ratioColor:i,riskRatio:t},void 0)},nt=({sideKey:e})=>{const{getI18n:i}=N(),{actionAdjustMarginModal:t}=(0,n.useContext)(O),s=(0,b.t2)(e,"positionSize"),r=(0,b.t2)(e,"isolated"),{formatedMargin:a}=(0,le.Yq)({sideKey:e}),l=r?i("headerIsolated",{defaultValue:"Isolated"}):i("header-Cross",{defaultValue:"Cross"}),c=(0,n.useCallback)((()=>{t(e)}),[t,e]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.m,Object.assign({tip:i("marginTip",{defaultValue:"The margin allocated to the current position."})},{children:i("margin",{defaultValue:"Margin"})}),void 0),(0,o.jsxs)(v.Z,Object.assign({alignItems:"center"},r&&{onClick:c},{children:[(0,o.jsx)(w.Z,Object.assign({variant:"captionSub",color:"t.primary"},{children:`${a} (${l})`}),void 0),0===Number(s)?null:r?(0,o.jsx)(Zi,{size:16,color:"t.third",ml:"4px"},void 0):null]}),void 0)]},void 0)},st=({sideKey:e})=>{const{getI18n:i}=N(),{isDelivery:t,actionTpslModal:s}=(0,n.useContext)(O),{formatedTPPrice:r,formatedSLPrice:a}=(0,le.Mn)({sideKey:e}),l=(0,n.useCallback)((()=>{s(e)}),[s,e]);return t?null:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(H.m,Object.assign({tip:i("tpSlTip")},{children:i("tpSl",{defaultValue:"TP/SL"})}),void 0),(0,o.jsxs)(v.Z,Object.assign({display:"inline-flex",alignItems:"center",justifyContent:"flex-end",onClick:l},{children:[(0,o.jsxs)(w.Z,Object.assign({variant:"captionSub",color:"t.primary"},{children:[r," / ",a]}),void 0),(0,o.jsx)(Zi,{size:16,color:"t.third",ml:"4px"},void 0)]}),void 0)]},void 0)},rt=(0,n.memo)((({sideKey:e,actionPlaceOrderModal:i})=>{const{assetMode:t}=(0,b.F7)(),s=(0,n.useCallback)((i=>{switch(i){case"size":return(0,o.jsx)(Bi,{sideKey:e},void 0);case"notionalSize":return(0,o.jsx)(Qi,{sideKey:e},void 0);case"pnl":return(0,o.jsx)(Wi,{sideKey:e},void 0);case"tpsl":return(0,o.jsx)(st,{sideKey:e},void 0);case"entryPrice":return(0,o.jsx)(Gi,{sideKey:e},void 0);case"markPrice":return(0,o.jsx)(Yi,{sideKey:e},void 0);case"liquidationPrice":return t?(0,o.jsx)(et,{sideKey:e},void 0):(0,o.jsx)(Xi,{sideKey:e},void 0);case"marginRatio":return t?(0,o.jsx)(ot,{sideKey:e},void 0):(0,o.jsx)(tt,{sideKey:e},void 0);case"margin":return(0,o.jsx)(nt,{sideKey:e},void 0);default:return null}}),[t,e]);return(0,o.jsxs)("div",Object.assign({className:"row-wrap"},{children:[(0,o.jsx)($i,{sideKey:e,actionPlaceOrderModal:i},void 0),Di.map((e=>(0,o.jsx)(Hi,{children:s(e)},e)))]}),void 0)})),at=["pnl","tpsl","size","notionalSize","marginRatio","margin","entryPrice","markPrice","liquidationPrice"],lt=({sideKey:e})=>{const{getI18n:i}=N(),{formatedPnl:t,pnlColor:n,ROEVal:s}=(0,le.qU)({sideKey:e});return(0,o.jsx)("div",Object.assign({className:"pnl"},{children:(0,o.jsxs)("span",{children:[(0,o.jsx)(Ui,{children:i("m-unrealizedPnl",{defaultValue:"Unrealized PNL(ROE %)"})},void 0),(0,o.jsx)(w.Z,Object.assign({variant:"subtitle1",color:n},{children:`${t}(${s})`}),void 0)]},void 0)}),void 0)},ct=(0,n.memo)((({sideKey:e,actionPlaceOrderModal:i})=>{const{assetMode:t}=(0,b.F7)(),s=(0,n.useCallback)((i=>{switch(i){case"size":return(0,o.jsx)(Bi,{sideKey:e},void 0);case"notionalSize":return(0,o.jsx)(Qi,{sideKey:e},void 0);case"pnl":return(0,o.jsx)(lt,{sideKey:e},void 0);case"tpsl":return(0,o.jsx)(st,{sideKey:e},void 0);case"entryPrice":return(0,o.jsx)(Gi,{sideKey:e},void 0);case"markPrice":return(0,o.jsx)(Yi,{sideKey:e},void 0);case"liquidationPrice":return t?(0,o.jsx)(et,{sideKey:e},void 0):(0,o.jsx)(Xi,{sideKey:e},void 0);case"marginRatio":return t?(0,o.jsx)(ot,{sideKey:e},void 0):(0,o.jsx)(tt,{sideKey:e},void 0);case"margin":return(0,o.jsx)(nt,{sideKey:e},void 0);default:return null}}),[t,e]);return(0,o.jsxs)("div",Object.assign({className:"row-wrap"},{children:[(0,o.jsx)($i,{sideKey:e,actionPlaceOrderModal:i},void 0),(0,o.jsx)("div",Object.assign({className:"row-grid"},{children:at.map((e=>(0,o.jsx)("div",Object.assign({className:e},{children:s(e)}),e)))}),void 0)]}),void 0)})),dt={position:"relative",flexDirection:"column",flex:"1 0",".action-bar":{display:"flex",justifyContent:"space-between",alignItems:"center",height:32,pt:10,label:{width:"auto"}},".empty":{display:"flex",minHeight:120,alignItems:"center",justifyContent:"center",color:"t.secondary",fontSize:0},".row-wrap":{fontSize:"12px",color:"t.primary",py:15,borderBottom:"1px solid",borderColor:"line","&:last-of-type":{mb:102,borderBottom:"none"},"& .row-item":{justifyContent:"space-between",alignItems:"center",py:"minor"},"& .symbol-wrap":{display:"flex",alignItems:"center",fontSize:0,"&.buy":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"buy"}},"&.sell":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"sell"}},"& .symbolText":{display:"flex",alignItems:"center",mx:"minor"},"& .symbol":{mr:"minor",fontSize:1,fontWeight:"medium"},"& .leverage":{px:"minor",mr:"6px",fontSize:0,color:"t.yellow",bg:"rgba(240, 185, 11, .15)",borderRadius:"2px"}},"& .close-position":{py:"minor",px:"xs",fontSize:0,color:"t.primary",bg:"line",borderRadius:"3px"}}},ut={position:"relative",flexDirection:"column",height:"100%",".action-bar":{display:"flex",justifyContent:"space-between",alignItems:"center",height:32,pt:0,label:{width:"auto"}},".empty":{display:"flex",minHeight:120,alignItems:"center",justifyContent:"center",color:"t.secondary",fontSize:0},".row-list":{height:"calc(100% - 32px)",overflow:"auto","&::-webkit-scrollbar":{display:"none"},"&::-webkit-scrollbar-thumb":{bg:"transparent"}},".row-wrap":{fontSize:"12px",color:"t.primary",py:"ls",borderBottom:"1px solid",borderColor:"line","&:last-of-type":{mb:15,borderBottom:"none"},".pnl":{display:"flex",alignItems:"center"},".row-grid":{display:"grid",alignItems:"center",gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"repeat(4, 1fr)",gridGap:"12px 16px",gridTemplateAreas:'"pnl pnl tpsl"\n        "size notionalSize marginRatio"\n        "margin entryPrice markPrice"\n        "liquidationPrice . ."',"& .pnl":{gridArea:"pnl"},"& .tpsl":{gridArea:"tpsl"},"& .tpsl, & .marginRatio, & .markPrice":{textAlign:"right"},"& .right-title":{justifyContent:"flex-end"}},"& .row-item":{justifyContent:"space-between",alignItems:"center"},"& .symbol-wrap":{display:"flex",alignItems:"center",fontSize:0,"&.buy":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"buy"}},"&.sell":{"&::before":{display:"block",content:"''",width:"4px",height:"4px",bg:"sell"}},"& .symbolText":{display:"flex",alignItems:"center",mx:"minor"},"& .symbol":{mr:"minor",fontSize:1,fontWeight:"medium"},"& .leverage":{px:"minor",mr:"6px",fontSize:0,color:"t.yellow",bg:"rgba(240, 185, 11, .15)",borderRadius:"2px"}},"& .close-position":{py:"minor",px:"xs",fontSize:0,color:"t.primary",bg:"line",borderRadius:"3px"}}},pt=()=>{const{getI18n:e}=N();return(0,o.jsx)("div",Object.assign({className:"empty"},{children:e("nodata",{defaultValue:"You have no position."})}),void 0)},mt=n.memo((({isMobile:e,isEmpty:i,loading:t,data:s=[]})=>{const[r,a]=(0,n.useState)(!1),[l,c]=(0,n.useState)(""),d=(0,n.useMemo)((()=>s.map((e=>({sideKey:e})))),[s]),u=(0,n.useCallback)((()=>{a(!1)}),[]),p=(0,n.useCallback)((e=>{a(!0),c(e)}),[a,c]);return(0,o.jsxs)(v.Z,Object.assign({sx:e?dt:ut},{children:[(0,o.jsx)(Le.Z,{fullScreen:!0,show:t},void 0),(0,o.jsx)(ei,{},void 0),i?(0,o.jsx)(pt,{},void 0):e?d.map((({sideKey:e})=>(0,o.jsx)(rt,{sideKey:e,actionPlaceOrderModal:p},e))):(0,o.jsx)("div",Object.assign({className:"row-list"},{children:d.map((({sideKey:e})=>(0,o.jsx)(ct,{sideKey:e,actionPlaceOrderModal:p},e)))}),void 0),(0,o.jsx)(Ki,{open:r,curSideKey:l,onClose:u},void 0)]}),void 0)}));var vt=t(18495),xt=t(24685);const gt=function(e){return n.createElement(zi.Z,(0,d.__assign)({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none"},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.997 12.21a8.161 8.161 0 000-.42v.42zm-4.463 3.327l-2.608-2.608h7.07V20l-2.341-2.342A8.003 8.003 0 014.252 14h3.164a5.001 5.001 0 008.118 1.537zM19.747 10A8.003 8.003 0 006.343 6.343L4.001 4v7.071h7.07L8.466 8.464A5.001 5.001 0 0116.585 10h3.162zM4 12L4 11.845v.31A8.126 8.126 0 014 12z",fill:"currentColor"}))};var ht=t(72779),bt=t.n(ht),yt=t(45219),ft=t(31793),jt=t(35626),kt=t(30105);const Ot=n.memo((({type:e})=>"default"===e?(0,o.jsx)(ft.Z,{className:"rank-icon",size:10},void 0):"desc"===e?(0,o.jsx)(jt.Z,{className:"rank-icon",size:10},void 0):"asc"===e?(0,o.jsx)(kt.Z,{className:"rank-icon",size:10},void 0):(0,o.jsx)(ft.Z,{className:"rank-icon",size:10},void 0)));var Pt=t(4058);const Ct={fontSize:0,color:"t.secondary",zIndex:9,whiteSpace:"nowrap",".rank-icon":{width:"10px",ml:"2px",transform:"scale(1.6)"}},St=(0,yt.JN)((({style:e,children:i})=>(0,o.jsx)("div",Object.assign({className:"position-row header",style:e},{children:i}),void 0))),wt=(0,yt.W8)((({value:e,className:i,itemKey:t,rankingType:s,isRankingEnable:r,onRanking:a})=>{const l=(0,n.useCallback)((e=>()=>{let i=h.rV.indexOf(e);i<2?i++:i=0,a({rankingKey:t,rankingType:h.rV[i]})}),[t,a]);return(0,o.jsx)(Z.Z,Object.assign({className:i,sx:Ct},r&&{onClick:l(s)},{children:e}),void 0)})),Tt=(0,o.jsx)(Pt.Z,{className:"drag-icon",size:12},void 0),Mt=(0,yt.W6)((e=>{var{showTip:i=!1,tip:t=""}=e,n=function(e,i){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&i.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)i.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(t[o[n]]=e[o[n]])}return t}(e,["showTip","tip"]);return i?(0,o.jsx)(H.m,Object.assign({tip:t},n,{children:Tt}),void 0):Tt}));var Kt=t(71775),Nt=t(74900);const zt={flexDirection:"column",padding:"4px",fontSize:"12px",".radio-title":{my:"10px",color:"t.white",opacity:"0.5"},".radio-row":{display:"flex",alignItems:"center"},svg:{color:"t.yellow"},".unchecked svg":{color:"t.white",cursor:"pointer"},".radio-label":{mr:"24px",fontSize:"12px",color:"t.white",cursor:"pointer"}};function Zt({tipText:e}){const i=(0,s.I0)(),{getI18n:t}=N(),{useLastPrice:n}=(0,Se.F7)(),r=e=>{(0,Kt.yN)({pnlPriceBasis:e},{}),i.preference.updateState({useLastPrice:"lastPrice"===e})};return(0,o.jsxs)(v.Z,Object.assign({sx:zt},{children:[e,(0,o.jsx)("div",Object.assign({className:"radio-title"},{children:t("selectPriceBasis",{defaultValue:"Select Price Basis"})}),void 0),(0,o.jsx)("div",Object.assign({className:"radio-row"},{children:["markPrice","lastPrice"].map((e=>{const i=n?"lastPrice"===e:"markPrice"===e;return(0,o.jsx)(Nt.ZP,Object.assign({className:bt()({unchecked:!i}),value:e,checked:i,onChange:r},{children:(0,o.jsx)("div",Object.assign({className:"radio-label"},{children:t(e)}),void 0)}),e)}))}),void 0)]}),void 0)}const It={fontSize:0,whiteSpace:"normal",lineHeight:"14px",maxHeight:"28px",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden"},Rt={maxWidth:"330px"},Lt={cursor:"pointer"},At=n.memo((({headers:e,onSort:i,style:t})=>{const r=(0,s.I0)(),{getI18n:a}=(0,x.yk)(),{showLiqRefresh:l,handleLiqRefresh:c}=Ei(),d=(0,n.useMemo)((()=>e.filter((({defaultChecked:e,unCheckedComponents:i})=>e||!e&&i))),[e]),u=(0,n.useMemo)((()=>e.filter((({key:e})=>!h.N3.includes(e))).reduce(((e,{key:i})=>(Object.assign(e,{[i]:!1}),e)),{})),[e]),[p,m]=(0,Pe.Z)(h.Nj,!1),[g,b]=(0,Pe.Z)(h.nK),[y,f]=(0,Pe.Z)(h.tC,u),j=(0,s.v9)((e=>e.position.rankingInfo)),{rankingKey:k,rankingType:O}=j,P=(0,n.useCallback)((e=>r.position.updateState({rankingInfo:e})),[r.position]),C=(0,n.useCallback)((e=>{const{rankingKey:i,rankingType:t}=e,o=null==y?void 0:y[i];P(e),b(e),!o&&f(Object.assign(Object.assign(Object.assign({},y),k?{[k]:!1}:{}),{[i]:!0})),"default"===t&&f(Object.assign(Object.assign({},y),{[i]:!1}))}),[k,b,y,f,P]),S=(0,n.useCallback)((e=>{e.stopPropagation()}),[]),T=(0,n.useCallback)((({name:e,tip:i,title:t,learnMoreLink:n,rankingIcon:s,isRankingEnable:r})=>{const a=Object.assign(Object.assign({},It),r?Lt:{});switch(e){case"pnl":return(0,o.jsxs)(H.m,Object.assign({onTipClick:S,tip:(0,o.jsx)(Zt,{tipText:i},void 0),tipSx:Rt,labelSx:a},{children:[t,s]}),void 0);case"closePosition":return(0,o.jsx)(Xe,{tip:i,title:t},void 0);case"liquidationPrice":return i?(0,o.jsxs)(H.m,Object.assign({onTipClick:S,tip:i,learnMoreLink:n,labelSx:a},{children:[(0,o.jsxs)(w.Z,{children:[t,s]},void 0),l&&(0,o.jsx)(gt,{ml:"3px",cursor:"pointer",size:12,flexShrink:0,onClick:c},void 0)]}),void 0):(0,o.jsxs)(v.Z,Object.assign({alignItems:"center"},{children:[(0,o.jsxs)(w.Z,Object.assign({sx:a,color:"t.third"},{children:[t,s]}),void 0),l&&(0,o.jsx)(gt,{ml:"3px",cursor:"pointer",size:12,flexShrink:0,onClick:c},void 0)]}),void 0);default:return i?(0,o.jsxs)(H.m,Object.assign({onTipClick:S,tip:i,learnMoreLink:n,labelSx:a},{children:[t,s]}),void 0):(0,o.jsx)(v.Z,Object.assign({alignItems:"center"},{children:(0,o.jsxs)(w.Z,Object.assign({sx:a,color:"t.third"},{children:[t,s]}),void 0)}),void 0)}}),[c,l]);return(0,n.useEffect)((()=>{g&&P(g)}),[g,P]),(0,o.jsx)(St,Object.assign({axis:"x",transitionDuration:100,useDragHandle:!0,onSortEnd:({oldIndex:e,newIndex:t})=>{var o;const n=d.map((e=>e.key));if(!(null===(o=d[t])||void 0===o?void 0:o.sortable))return!1;i((0,yt.Rp)(n,e,t))},style:t},{children:d.map(((e,i)=>{const{key:t,className:n,title:s,tip:r,sortable:l,learnMoreLink:c,unCheckedComponents:d,defaultChecked:u}=e,v=!u&&d?d.title:s,x=!u&&d?d.tip:r,g=k===t?O:"default",b=!h.N3.includes(t),f=(0,o.jsxs)(o.Fragment,{children:[T({name:t,tip:x,title:v,learnMoreLink:c,isRankingEnable:b,rankingIcon:b?(0,o.jsx)(Ot,{type:g},void 0):null}),l&&(0,o.jsx)(Mt,{showTip:!p,onMouseLeave:()=>{!p&&m(!0)},tip:a("dragToMove",{defaultValue:"Drag to Move"})},void 0)]},void 0);return(0,o.jsx)(wt,{index:i,value:f,className:bt()(n,{"header-item":!0,"show-ranking":null==y?void 0:y[t]}),itemKey:t,rankingType:g,isRankingEnable:b,onRanking:C},t)}))}),void 0)}));var Vt=t(35054),qt=t(28123),Et=t(18046),_t=t(23563);const Dt={padding:"16px",bg:"popupBg",boxShadow:"elevation2",borderRadius:"4px",".check-header":{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"14px","& .name":{color:"t.secondary",marginRight:"16px"}},".sort-header":{color:"t.third",display:"flex",justifyContent:"flex-start",alignItems:"center","& .back":{marginLeft:"8px",cursor:"pointer",fontSize:"12px"}}},Ut=["notionalSize","adl","tpSl","closePosition"],Ft=(0,n.memo)((({headers:e=[],onSort:i,onCheck:t})=>{const s=e.map((e=>Object.assign(Object.assign({},e),{value:e.key,label:e.title}))),r=s.filter((e=>e.sortable&&(e.defaultChecked||e.alwaysShowInColumn))).map((e=>Object.assign(Object.assign({},e),{label:e.sortingTitle||e.title}))),a=s.filter((e=>e.checkable));a.sort(((e,i)=>Ut.indexOf(e.value)-Ut.indexOf(i.value)));const{getI18n:l}=(0,x.yk)(),[c,d]=(0,n.useState)("check");return"check"===c?(0,o.jsxs)(Z.Z,Object.assign({__css:Dt,onClick:e=>e.stopPropagation()},{children:[(0,o.jsxs)("div",Object.assign({className:"check-header"},{children:[(0,o.jsx)(w.Z,Object.assign({variant:"captionSub",className:"name"},{children:l("positions-preferenceTitle")}),void 0),(0,o.jsx)("div",Object.assign({className:"action"},{children:(0,o.jsx)(E.Z,Object.assign({variant:"defaultLink",__css:{cursor:"pointer"},onClick:e=>{e.stopPropagation(),d("sort")}},{children:l("positions-preferenceSort")}),void 0)}),void 0)]}),void 0),(0,o.jsx)("div",Object.assign({className:"list"},{children:(0,o.jsx)(qt.Z,{options:a,getValue:e=>{const o=Object.keys(e)[0],n=e[o];t&&t(a.map((e=>e.value===o?Object.assign(Object.assign({},e),{defaultChecked:n}):e)).filter((e=>e.defaultChecked)).map((e=>e.value)));let s=r.map((e=>e.value));n?s.push(o):s=s.filter((e=>e!==o)),i&&i(s.concat(o))}},void 0)}),void 0)]}),void 0):(0,o.jsxs)(Z.Z,Object.assign({__css:Dt,onClick:e=>e.stopPropagation()},{children:[(0,o.jsxs)("div",Object.assign({className:"sort-header"},{children:[(0,o.jsx)(_t.Z,{size:16,onClick:()=>{d("check")}},void 0),(0,o.jsx)("div",Object.assign({className:"back",onClick:()=>{d("check")}},{children:l("positions-preferenceBack")}),void 0)]}),void 0),(0,o.jsx)("div",Object.assign({className:"list"},{children:(0,o.jsx)(Et.Z,{items:r,onSort:e=>{i&&i(e)}},void 0)}),void 0)]}),void 0)})),Ht=n.memo((({headers:e,onCheck:i,onSort:t})=>(0,o.jsxs)("div",Object.assign({className:"action-bar"},{children:[(0,o.jsx)(qe,{},void 0),(0,o.jsx)(li.ZP,Object.assign({trigger:"click",sx:{marginLeft:16,marginTop:"4px"},overlay:(0,o.jsx)(Ft,{headers:e,onCheck:i,onSort:t},void 0),overlayProps:{marginBottom:"8px"},placement:"top",enablePortal:!0},{children:(0,o.jsx)(Vt.Z,{mr:"8px",fontSize:"20px",sx:{color:"icons.close",cursor:"pointer","&:hover path":{fill:"t.third"}}},void 0)}),void 0)]}),void 0)));var $t=t(30068);const Bt=function(e){return n.createElement(zi.Z,(0,d.__assign)({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none"},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.879 3.293l2.828 2.828-2.12 2.121-2.83-2.828 2.122-2.121zm-3.183 3.182l2.829 2.829-4.667 4.666H10.03v-2.828l4.666-4.667zM7 4h4v3H7v10h10v-4h3v7H4V4h3z",fill:"currentColor"}))};var Qt=t(65916);const Wt=(0,h.nM)(),Gt=({sideKey:e})=>{const{changeSymbol:i}=(0,n.useContext)(O),t=(0,b.t2)(e,"symbol"),{color:s,symbolText:r,symbolName:a,leverage:l}=(0,le.iA)({sideKey:e});return(0,o.jsxs)("div",Object.assign({className:"symbol",onClick:()=>i({symbol:t})},{children:[(0,o.jsx)("div",{className:`bar bar-${s}`},void 0),(0,o.jsx)(Qt.O,{symbolName:a,fallbackText:r},void 0),(0,o.jsx)("div",Object.assign({className:"leverage"},{children:`${l}x`}),void 0),(0,o.jsx)($t.Z,{size:16,color:"t.yellow",className:"symbolRightArrow"},void 0)]}),void 0)},Yt=({columnKey:e,sideKey:i})=>{const{color:t,formatedQuantityAmount:n,unit:s}=(0,le.v_)({sideKey:i,columnKey:e});return(0,o.jsx)("div",Object.assign({className:`size size-${t}`},{children:`${n} ${s}`}),void 0)},Jt=({columnKey:e,sideKey:i})=>{const{formattedNotionalSize:t,unit:n}=(0,le.jK)({sideKey:i,columnKey:e});return(0,o.jsx)("div",Object.assign({className:"notionalSize"},{children:`${t} ${n}`}),void 0)},Xt=({sideKey:e})=>{const{formatedEntryPrice:i}=(0,le.A4)({sideKey:e});return(0,o.jsx)("div",Object.assign({className:"entryPrice"},{children:i}),void 0)},eo=({sideKey:e})=>{const{formatedMarkPrice:i}=(0,le.z1)({sideKey:e});return(0,o.jsx)("div",Object.assign({className:"markPrice"},{children:i}),void 0)},io={color:"t.emphasize","&:hover":{color:"t.emphasize"}},to=(0,n.memo)((({validLiq:e,formatedLiqPrice:i})=>{const{showLiqRefresh:t,handleLiqRefresh:n}=Ei(),{getI18n:s}=N(),{getI18n:r}=(0,x.yk)();return(0,o.jsx)("div",Object.assign({className:"liquidationPrice"},{children:t?(0,o.jsx)(H.m,Object.assign({tip:s("liquidationPriceRefreshTip",{defaultValue:""}),labelSx:io},{children:(0,o.jsx)("div",Object.assign({className:"liqRefresh",onClick:n},{children:r("refresh",{defaultValue:"Refresh"})}),void 0)}),void 0):e?i:(0,o.jsx)(H.m,Object.assign({tip:s("liquidationPriceLowRiskTip",{defaultValue:""}),labelSx:io},{children:"- -"}),void 0)}),void 0)})),oo=({columnKey:e,sideKey:i})=>{const{liquidationPrice:t,formatedLiqPrice:n}=(0,le.Mx)({sideKey:i,columnKey:e}),s=t>0;return(0,o.jsx)(to,{validLiq:s,formatedLiqPrice:n},void 0)},no=({columnKey:e,sideKey:i})=>{const{liquidationPrice:t,formatedLiqPrice:n}=(0,_i.e)({sideKey:i,columnKey:e}),s=t>0;return(0,o.jsx)(to,{validLiq:s,formatedLiqPrice:n},void 0)},so=({ratioColor:e,riskRatio:i})=>(0,o.jsxs)("div",Object.assign({className:`marginRatio marginRatio-${e}`},{children:[i,"%"]}),void 0),ro=({columnKey:e,sideKey:i})=>{const{ratioColor:t,riskRatio:n}=(0,le.ek)({sideKey:i,columnKey:e});return(0,o.jsx)(so,{ratioColor:t,riskRatio:n},void 0)},ao=({columnKey:e,sideKey:i})=>{const{ratioColor:t,riskRatio:n}=(0,_i.U)({sideKey:i,columnKey:e});return(0,o.jsx)(so,{ratioColor:t,riskRatio:n},void 0)},lo=({columnKey:e,sideKey:i})=>{const[t,s]=(0,n.useState)(!1),{assetMode:r}=(0,b.F7)(),{actionAdjustMarginModal:a}=(0,n.useContext)(O),l=(0,b.t2)(i,"positionSize"),c=(0,b.t2)(i,"isolated"),d=(0,b.t2)(i,"isolatedWallet"),{getI18n:u}=N(),p=c?u("headerIsolated",{defaultValue:"Isolated"}):u("header-Cross",{defaultValue:"Cross"}),{formatedMargin:m}=(0,le.Yq)({sideKey:i,columnKey:e}),v=(0,n.useCallback)((()=>{c&&(0===Number(l)&&d<0?Ce.ee.emit("SHOW_NEG_BALANCE_CLEAR_MODAL",{isJoinMargin:r,isolated:c,isCM:Wt}):a(i))}),[a,r,c,d,l,i]),x=(0,n.useMemo)((()=>(0,o.jsx)(Bt,{size:16,color:t?"t.primary":"t.third"},void 0)),[t]);return(0,o.jsx)(o.Fragment,{children:c?(0,o.jsxs)("div",Object.assign({className:"margin",style:{minWidth:"auto",cursor:"pointer"},onClick:v,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1)},{children:[(0,o.jsxs)("div",Object.assign({className:"margin-text"},{children:[(0,o.jsx)("div",{children:m},void 0),(0,o.jsx)("div",{children:`(${p})`},void 0)]}),void 0),(0,o.jsxs)("div",Object.assign({className:"margin-icon-container"},{children:[x,d<0&&(0,o.jsx)("div",{className:"red-point"},void 0)]}),void 0)]}),void 0):(0,o.jsx)("div",Object.assign({className:"margin"},{children:(0,o.jsxs)("div",Object.assign({className:"margin-text"},{children:[(0,o.jsx)("div",{children:m},void 0),(0,o.jsx)("div",{children:`(${p})`},void 0)]}),void 0)}),void 0)},void 0)},co=({columnKey:e,sideKey:i})=>{const{formatedPnl:t,pnlColor:n,ROEVal:s}=(0,le.qU)({sideKey:i,columnKey:e});return(0,o.jsxs)("div",Object.assign({className:`pnl pnl-${n}`},{children:[(0,o.jsxs)("span",{children:[(0,o.jsx)("div",{children:t},void 0),(0,o.jsx)("div",{children:`(${s})`},void 0)]},void 0),(0,o.jsx)(Ii.Z,{sideKey:i},void 0)]}),void 0)},uo=({sideKey:e})=>{const i=(0,b.t2)(e,"adl");return(0,o.jsx)("div",Object.assign({className:"adl"},{children:(0,o.jsx)(Vi,{adl:i},void 0)}),void 0)},po=({sideKey:e})=>{const i=(0,b.t2)(e,"positionSize");return(0,o.jsx)("div",Object.assign({className:"closePosition"},{children:i?(0,o.jsx)(wi,{sideKey:e},void 0):(0,o.jsx)(o.Fragment,{},void 0)}),void 0)},mo=({columnKey:e,sideKey:i})=>{const{actionTpslModal:t}=(0,n.useContext)(O),{formatedTPPrice:s,formatedSLPrice:r}=(0,le.Mn)({sideKey:i,columnKey:e}),a=(0,n.useMemo)((()=>(0,o.jsx)(Bt,{size:16,sx:{cursor:"pointer",color:"t.third","&:hover":{color:"t.primary"}},onClick:()=>t(i)},void 0)),[i,t]);return(0,o.jsxs)("div",Object.assign({className:"tpSl"},{children:[(0,o.jsxs)("div",Object.assign({className:"tpSl-text"},{children:[(0,o.jsxs)("div",{children:[s," /"]},void 0),(0,o.jsx)("div",{children:r},void 0)]}),void 0),a]}),void 0)},vo=(0,n.memo)((({sideKey:e})=>{const{assetMode:i}=(0,b.F7)(),{headers:t}=(0,n.useContext)(O),s=(0,n.useCallback)((({key:t})=>{switch(t){case"symbol":return(0,o.jsx)(Gt,{sideKey:e,columnKey:t},t);case"size":return(0,o.jsx)(Yt,{sideKey:e,columnKey:t},t);case"notionalSize":return(0,o.jsx)(Jt,{sideKey:e,columnKey:t},t);case"entryPrice":return(0,o.jsx)(Xt,{sideKey:e,columnKey:t},t);case"markPrice":return(0,o.jsx)(eo,{sideKey:e,columnKey:t},t);case"liquidationPrice":return i?(0,o.jsx)(no,{sideKey:e,columnKey:t},t):(0,o.jsx)(oo,{sideKey:e,columnKey:t},t);case"marginRatio":return i?(0,o.jsx)(ao,{sideKey:e,columnKey:t},t):(0,o.jsx)(ro,{sideKey:e,columnKey:t},t);case"margin":return(0,o.jsx)(lo,{sideKey:e,columnKey:t},t);case"pnl":return(0,o.jsx)(co,{sideKey:e,columnKey:t},t);case"adl":return(0,o.jsx)(uo,{sideKey:e,columnKey:t},t);case"closePosition":return(0,o.jsx)(po,{sideKey:e,columnKey:t},t);case"tpSl":return(0,o.jsx)(mo,{sideKey:e,columnKey:t},t);default:return(0,o.jsx)("div",{},void 0)}}),[i,e]);return(0,o.jsx)("div",Object.assign({className:"position-row body"},{children:t.filter((e=>e.defaultChecked||e.alwaysShowInColumn)).map(s)}),void 0)})),xo=e=>(0,o.jsx)(vo,Object.assign({},e),void 0),go=(e,i)=>i[e].sideKey,ho=n.memo((({loading:e,headers:i,onCheckHeader:t,onSortHeader:r,data:a=[]})=>{const l=(()=>{const e=(0,b.AM)(),i=(0,s.v9)((e=>e.position.positionMap)),t=(0,Me.ZP)(Me.ME),{rankingKey:o,rankingType:r}=(0,s.v9)((e=>e.position.rankingInfo)),a=(0,n.useCallback)(((e,o,n=!1)=>{var s;return null===(s=Re(e,n?t:i))||void 0===s?void 0:s[o]}),[t,i]),l=(0,n.useCallback)((t=>{const{symbol:o=""}=Re(t,i)||{},n=null==e?void 0:e[o],{pair:s="",baseAsset:r="",quoteAsset:a=""}=n,l=function(e,i){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&i.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)i.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(t[o[n]]=e[o[n]])}return t}(n,["pair","baseAsset","quoteAsset"]);return Object.assign({symbolName:s||`${r}${a}`},l)}),[i,e]);return(0,n.useMemo)((()=>{const e=[],i=Ie.includes(o);return("entryPrice"===o||"markPrice"===o||i)&&("asc"===r?e.push(((e,t)=>Ze(a(e,o,i),a(t,o,i)))):"desc"===r&&e.push(((e,t)=>ze(a(e,o,i),a(t,o,i))))),"symbol"===o&&"default"!==r&&("asc"===r?e.push(((e,i)=>Ne(l(e).symbolName,l(i).symbolName))):"desc"===r&&e.push(((e,i)=>Ke(l(e).symbolName,l(i).symbolName))),e.push(((e,i)=>{const{symbolName:t,contractType:o}=l(e),{symbolName:n,contractType:s}=l(i);return t!==n?0:ze((0,Te.vgT)(o,h.IR),(0,Te.vgT)(s,h.IR))})),e.push(((e,i)=>ze((0,Te.vgT)("positionSide",a(e,o)),(0,Te.vgT)("positionSide",a(i,o)))))),(0,Te.HCG)(e)}),[o,r,a,l])})(),c=(0,n.useMemo)((()=>l(a).map((e=>({sideKey:e})))),[a,l]),d=(0,n.useMemo)((()=>{let e=0;return i.filter((e=>e.defaultChecked||!e.defaultChecked&&e.unCheckedComponents)).forEach((({key:i})=>{e+=gi[i]||0})),{minWidth:e}}),[i]),{getI18n:u}=(0,x.yk)(),{apiError:p,onRefresh:m}=(()=>{const[e]=(0,b.z4)(),i=(0,s.v9)((e=>e.loading.effects.position.queryPosition)),t=(0,s.v9)((e=>e.position.apiError)),o=(0,s.I0)(),r=(0,n.useCallback)((()=>{i||o.position.queryPosition({symbol:e})}),[i,o.position]);return(0,n.useMemo)((()=>({loading:i,apiError:t,onRefresh:r})),[i,t,r])})(),g=Ge({hideOtherSymbol:!1});return(0,o.jsx)("div",Object.assign({id:"position-pc",style:{height:"100%"}},{children:(0,o.jsxs)(v.Z,Object.assign({sx:bi},{children:[(0,o.jsx)(Ht,{headers:i,onSort:r,onCheck:t},void 0),(0,o.jsx)(At,{headers:i,onSort:r,style:d},void 0),(0,o.jsx)(xt.v,Object.assign({apiError:p,confirmTip:u("positionErrorConfirmTip",{defaultValue:"Cancel all open orders and close all positions here."}),onRefresh:m,onConfirm:g},{children:(0,o.jsx)(vt.a,{direction:"xxx",dataSource:c,loading:e,loadWithContent:!0,listSx:d,itemElement:xo,itemKey:go,itemHeight:40},void 0)}),void 0)]}),void 0)}),void 0)})),bo=(0,h.nM)(),yo=n.memo((()=>{const e=(0,s.v9)((e=>e.loading.effects.position.queryPosition)),{i18n:i}=N(),{getI18n:t}=(0,x.yk)(),[r,{onCheckHeader:d,onSortHeader:u}]=(({getFutI18n:e})=>{const{useLastPrice:i}=(0,Se.F7)(),{i18n:{language:t}}=(0,x.ZK)(),s=i?"lastPrice":"markPrice",[r,a]=(0,Pe.Z)(h.Zt,["closePosition","tpSl"]),[l,c]=(0,Pe.Z)(h.o5,["symbol","size","entryPrice","markPrice","liquidationPrice","marginRatio","margin","pnl","closePosition","tpSl"]),d=(0,h.nM)();return[(0,n.useMemo)((()=>{const i=[{key:"symbol",className:"symbol",title:e("symbol",{defaultValue:"Symbol"}),checkable:!1,sortable:!1},{key:"size",className:"size",title:e("size",{defaultValue:"Size"}),tip:d?e("cSizeDes",{defaultValue:"Trading units using coins in COIN-M Futures such as BTC, open position amounts shown are calculated based on the actual cont quantity. Values change with the last price of the symbol."}):e("uSizeDes",{defaultValue:"Trading units using stable coins in USDⓈ-M Futures such as USDT, open position amounts shown are calculated based on the actual coin quantity. Values change with the last price of the symbol."}),checkable:!1,sortable:!0},{key:"notionalSize",className:"notionalSize",title:e("notionalSize",{defaultValue:"Notional Size"}),checkable:!0,sortable:!0},{key:"entryPrice",className:"entryPrice",title:e("entryPrice",{defaultValue:"Entry Price"}),tip:e("entryPriceTip",{defaultValue:"Average executed buy/sell price for your current long/short position."}),checkable:!1,sortable:!0},{key:"markPrice",className:"markPrice",title:e("markPrice",{defaultValue:"Mark Price"}),tip:(0,o.jsx)(we,{getFutI18n:e},void 0),checkable:!1,sortable:!0},{key:"liquidationPrice",className:"liquidationPrice",title:e("liquidationPrice",{defaultValue:"Liq.Price"}),tip:e("liquidationPriceTip",{defaultValue:"If the mark price of the contract reaches below this price (when long) or above this price(when short), your position will be liquidated."}),learnMoreLink:(0,Ce.CN)(h.Wh.LIQ_PRICE,{locale:(0,$.sU)(t)}),checkable:!1,sortable:!0},{key:"marginRatio",className:"marginRatio",title:e("marginRatio",{defaultValue:"Margin Ratio"}),tip:e("marginRatioTip",{defaultValue:"The lower the Margin Ratio, the lower your liquidation level will be relative to your position size. Your positions will be liquidated once Margin Ratio reaches 100%."}),checkable:!1,sortable:!0},{key:"margin",className:"margin",title:e("margin",{defaultValue:"Margin"}),tip:e("marginTip",{defaultValue:"The margin allocated to the current position."}),checkable:!1,sortable:!0},{key:"pnl",className:"pnl",title:e("unrealizedPnl",{defaultValue:"PNL(ROE %)"}),tip:e(`unrealizedPnlTip-${s}`),checkable:!1,sortable:!0},{key:"adl",className:"adl",title:e("adl",{defaultValue:"ADL"}),tip:e("adlTip",{defaultValue:"This indicator shows your position in the auto-deleverage queue. If all lights are lit, in the event of a liquidation, your position may be reduced."}),checkable:!0,sortable:!0},{key:"closePosition",className:"closePosition",title:e("closePosition",{defaultValue:"Close All Position"}),tip:e("closePositionTip",{defaultValue:"Closing all positions cancels all open orders under {{futuresType}} and close all positions under {{futuresType}} by market order.",futuresType:d?"COIN-M":"USDⓈ-M"}),alwaysShowInColumn:!0,unCheckedComponents:{title:e("positions-action",{defaultValue:"Action"}),tip:null},sortingTitle:e("positions-preferenceAction",{defaultValue:"Action (Market/Limit)"}),checkable:!0,sortable:!0},{key:"tpSl",className:"tpSl",title:e("tpSlV2",{defaultValue:"TP/SL for position"}),tip:e("tpSlTip"),checkable:!0,sortable:!0}].map((e=>Object.assign(Object.assign({},e),{defaultChecked:!e.checkable||(null==r?void 0:r.includes(e.key))||!1})));return i.sort(((e,i)=>l?l.indexOf(e.key)-l.indexOf(i.key):0)),i}),[e,d,t,s,r,l]),{onCheckHeader:a,onSortHeader:c}]})({getFutI18n:t}),{preOrders:p=[]}=(0,b.E)(),{delOpenOrders:y}=m(),f=(0,b.Dj)(),{enqueueNotification:j}=(0,l.Z)(),[k,P]=(0,n.useState)(""),[S,w]=(0,n.useState)({}),{curLeverage:T}=(0,b.rf)(),{language:M="en"}=i,K=(0,b.d0)(),z=!e&&0===f.length,Z=(0,n.useCallback)((()=>{P(""),w({})}),[P,w]),I=(0,n.useCallback)((e=>{P("ADJUST_MARGIN"),w({sideKey:e})}),[P,w]),R=(0,n.useCallback)((e=>{P("TP_SL"),w({sideKey:e})}),[P,w]),L=(0,n.useCallback)(((e,i,t)=>{P("ORDER_CONFIRM"),w({sideKey:e,closeParams:i,onConfirm:t})}),[P,w]),A=(0,n.useCallback)((e=>{const{price:i,positionSide:o,type:n}=e,s="MARKET"===n;if(!s&&!i)return Promise.resolve();const r={leverage:T,timeInForce:h.rb.GTC,reduceOnly:!0};let l=Object.assign(Object.assign({},e),r);return a()(l,"buyQty","sellQty"),s&&(l.newOrderRespType="RESULT",l=a()(l,"price","timeInForce")),"LONG"!==o&&"SHORT"!==o||(l=a()(l,"reduceOnly")),(0,c.cG)((0,be.$)(Object.assign(Object.assign({},l),{placeType:"position"}),{isLiteMode:!1}),{language:M}).then((e=>{const{success:i,message:o,data:n}=e||{};return i&&!o&&j({message:t("order-submitted",{defaultValue:""}),variant:"success"}),Promise.resolve(n)})).catch((()=>{}))}),[T,M,j,t]),V=(0,n.useCallback)((e=>{const i=p.filter((i=>(null==i?void 0:i.orderId)===e));return 1===i.length?y(i[0]):Promise.resolve()}),[y,p]),q=(0,n.useMemo)((()=>({actionAdjustMarginModal:I,actionTpslModal:R,actionOrderConfirmModal:L,actionCancelOrder:V,actionPlaceOrder:A,changeSymbol:K,isDelivery:bo,headers:r})),[I,R,L,V,A,K,r]);return(0,o.jsx)(O.Provider,Object.assign({value:q},{children:(0,o.jsx)(v.Z,Object.assign({sx:{flexDirection:"column",height:"100%",pb:[0,0,"xs"],px:"sm"}},{children:(0,o.jsx)(g.Z,{children:({isMobile:i,isIPad:t})=>(0,o.jsxs)(o.Fragment,{children:[t?(0,o.jsx)(mt,{isMobile:i,isEmpty:z,loading:e,data:f},void 0):(0,o.jsx)(ho,{headers:r,onCheckHeader:d,onSortHeader:u,data:f,loading:e},void 0),"ADJUST_MARGIN"===k&&(0,o.jsx)(J,{visible:!0,position:S,onClose:Z},void 0),"ORDER_CONFIRM"===k&&(0,o.jsx)(C,{visible:!0,position:S,onClose:Z},void 0),"TP_SL"===k&&(0,o.jsx)(ke,{visible:!0,position:S,onClose:Z},void 0)]},void 0)},void 0)}),void 0)}),void 0)}))}}]);